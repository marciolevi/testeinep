<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>📅 Cronograma Revalida/Enamed 2025</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        /* =================================================================================
   CRONOGRAMA REVALIDA 2025 - CSS MODERNO E TECNOLÓGICO
   Design inspirado em dashboards de apps modernos com visual clean e profissional
   VERSÃO COM AJUSTES DE TAMANHO E PROPORÇÃO
   ================================================================================= */

/* Estilos da tela de login - NOVA VERSÃO BONITA */
#auth-container {
    min-height: 100vh;
    position: relative;
    overflow: hidden;
    background: linear-gradient(135deg, #0f172a 0%, #581c87 25%, #0f172a 50%, #1e1b4b 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 1rem;
}

/* Background Elements */
#auth-container::before {
    content: '';
    position: absolute;
    inset: 0;
}

.blob-1 {
    position: absolute;
    top: 0;
    left: -1rem;
    width: 18rem;
    height: 18rem;
    background: #8b5cf6;
    border-radius: 50%;
    mix-blend-mode: multiply;
    filter: blur(40px);
    opacity: 0.2;
    animation: blob 7s infinite;
}

.blob-2 {
    position: absolute;
    top: 0;
    right: -1rem;
    width: 18rem;
    height: 18rem;
    background: #3b82f6;
    border-radius: 50%;
    mix-blend-mode: multiply;
    filter: blur(40px);
    opacity: 0.2;
    animation: blob 7s infinite;
    animation-delay: 2s;
}

.blob-3 {
    position: absolute;
    bottom: -2rem;
    left: 5rem;
    width: 18rem;
    height: 18rem;
    background: #ec4899;
    border-radius: 50%;
    mix-blend-mode: multiply;
    filter: blur(40px);
    opacity: 0.2;
    animation: blob 7s infinite;
    animation-delay: 4s;
}

@keyframes blob {
    0% {
        transform: translate(0px, 0px) scale(1);
    }
    33% {
        transform: translate(30px, -50px) scale(1.1);
    }
    66% {
        transform: translate(-20px, 20px) scale(0.9);
    }
    100% {
        transform: translate(0px, 0px) scale(1);
    }
}

.grid-overlay {
    position: absolute;
    inset: 0;
    opacity: 0.05;
    background-image: 
        linear-gradient(rgba(255, 255, 255, 0.1) 1px, transparent 1px),
        linear-gradient(90deg, rgba(255, 255, 255, 0.1) 1px, transparent 1px);
    background-size: 20px 20px;
}

.content-container {
    position: relative;
    z-index: 10;
    width: 100%;
    max-width: 96rem;
    margin: 0 auto;
    display: grid;
    grid-template-columns: 1fr;
    gap: 3rem;
    align-items: center;
}

@media (min-width: 1024px) {
    .content-container {
        grid-template-columns: 1fr 1fr;
    }
}

/* Left side - Marketing Content */
.marketing-content {
    display: none;
    color: white;
}

@media (min-width: 1024px) {
    .marketing-content {
        display: block;
    }
}

.brand-header {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    margin-bottom: 1.5rem;
}

.brand-icon {
    width: 3rem;
    height: 3rem;
    background: linear-gradient(135deg, #60a5fa 0%, #8b5cf6 100%);
    border-radius: 0.75rem;
    display: flex;
    align-items: center;
    justify-content: center;
}

.brand-icon i {
    font-size: 1.25rem;
    color: white;
}

.brand-title {
    font-size: 2.25rem;
    font-weight: 900;
    background: linear-gradient(90deg, #60a5fa 0%, #8b5cf6 50%, #ec4899 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.brand-subtitle {
    color: rgba(255, 255, 255, 0.7);
    font-size: 1.125rem;
}

.features-list {
    margin-bottom: 2rem;
}

.feature-item {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-bottom: 1rem;
}

.feature-icon {
    width: 2.5rem;
    height: 2.5rem;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
}

.feature-icon.green {
    background: rgba(34, 197, 94, 0.2);
    color: #4ade80;
}

.feature-icon.blue {
    background: rgba(59, 130, 246, 0.2);
    color: #60a5fa;
}

.feature-icon.purple {
    background: rgba(139, 92, 246, 0.2);
    color: #a78bfa;
}

.feature-icon.orange {
    background: rgba(249, 115, 22, 0.2);
    color: #fb923c;
}

.feature-title {
    font-weight: 600;
    font-size: 1.125rem;
    margin-bottom: 0.25rem;
}

.feature-description {
    color: rgba(255, 255, 255, 0.6);
}

.stats-section {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 1.5rem;
    padding-top: 2rem;
    border-top: 1px solid rgba(255, 255, 255, 0.1);
}

.stat-item {
    text-align: center;
}

.stat-number {
    font-size: 1.875rem;
    font-weight: 900;
}

.stat-number.blue {
    color: #60a5fa;
}

.stat-number.purple {
    color: #a78bfa;
}

.stat-number.pink {
    color: #f472b6;
}

.stat-label {
    color: rgba(255, 255, 255, 0.6);
    font-size: 0.875rem;
}

/* Auth Form */
.auth-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
}

.auth-form-wrapper {
    width: 100%;
    max-width: 28rem;
}

.auth-toggle {
    margin-bottom: 1.5rem; /* Reduzido */
}

.toggle-container {
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(12px);
    border-radius: 1rem;
    padding: 0.5rem;
    display: flex;
}

.toggle-button {
    flex: 1;
    padding: 0.75rem 1.5rem;
    border-radius: 0.75rem;
    font-weight: 600;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    background: none;
    border: none;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
}

.toggle-button.active {
    background: linear-gradient(90deg, #3b82f6 0%, #8b5cf6 100%);
    color: white;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}

.toggle-button.inactive {
    color: rgba(255, 255, 255, 0.7);
}

.toggle-button.inactive:hover {
    color: white;
}

.auth-form {
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(40px);
    border-radius: 1.5rem;
    padding: 1.5rem; /* Reduzido */
    box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
    border: 1px solid rgba(255, 255, 255, 0.2);
}

.form-header {
    text-align: center;
    margin-bottom: 1.5rem; /* Reduzido */
}

.form-icon {
    width: 3.5rem; /* Reduzido */
    height: 3.5rem; /* Reduzido */
    background: linear-gradient(135deg, #60a5fa 0%, #8b5cf6 100%);
    border-radius: 1rem;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 1rem;
}

.form-icon i {
    font-size: 1.5rem;
    color: white;
}

.auth-form h2 {
    font-size: 1.5rem;
    font-weight: 700;
    color: white;
    margin-bottom: 0.5rem;
}

.form-subtitle {
    color: rgba(255, 255, 255, 0.7);
    font-size: 0.9rem; /* Reduzido */
}

.form-fields {
    margin-bottom: 1.5rem;
}

.field-group {
    position: relative;
    margin-bottom: 1.25rem; /* Reduzido */
}

#username-group {
    display: none; /* Começa oculto */
}

.field-icon {
    position: absolute;
    left: 1rem;
    top: 50%;
    transform: translateY(-50%);
    color: rgba(255, 255, 255, 0.5);
    pointer-events: none;
}

.auth-form input {
    width: 100%;
    padding: 0.9rem 1rem 0.9rem 3rem; /* Reduzido */
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 0.75rem;
    color: white;
    font-size: 1rem;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    backdrop-filter: blur(12px);
}

.auth-form input::placeholder {
    color: rgba(255, 255, 255, 0.5);
}

.auth-form input:focus {
    outline: none;
    border-color: #3b82f6;
    box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.2), 0 8px 16px rgba(0, 0, 0, 0.2);
    transform: translateY(-2px);
    background: rgba(255, 255, 255, 0.08);
}

.auth-form button {
    width: 100%;
    background: linear-gradient(90deg, #3b82f6 0%, #8b5cf6 100%);
    color: white;
    border: none;
    padding: 0.9rem 1.5rem; /* Reduzido */
    border-radius: 0.75rem;
    font-weight: 600;
    font-size: 1rem;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: 0 8px 20px rgba(59, 130, 246, 0.4), 0 0 0 1px rgba(255, 255, 255, 0.1);
    position: relative;
    overflow: hidden;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
}

.auth-form button::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
    transition: left 0.5s;
}

.auth-form button:hover::before {
    left: 100%;
}

.auth-form button:hover {
    transform: translateY(-3px);
    box-shadow: 0 12px 30px rgba(59, 130, 246, 0.5), 0 0 0 1px rgba(255, 255, 255, 0.2);
    background: linear-gradient(90deg, #2563eb 0%, #7c3aed 100%);
}

.auth-form button:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    transform: none;
}

.loading-spinner {
    width: 1.25rem;
    height: 1.25rem;
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-top: 2px solid white;
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    to {
        transform: rotate(360deg);
    }
}

.form-footer {
    margin-top: 1.5rem; /* Reduzido */
    text-align: center;
}

.auth-form p {
    color: rgba(255, 255, 255, 0.6);
    font-size: 0.875rem;
}

.auth-form a {
    color: #60a5fa;
    background: none;
    border: none;
    font-weight: 600;
    cursor: pointer;
    transition: color 0.2s;
    margin-left: 0.25rem;
    text-decoration: none;
}

.auth-form a:hover {
    color: #3b82f6;
    text-shadow: 0 0 8px rgba(59, 130, 246, 0.4);
}

.security-badge {
    margin-top: 1.5rem;
    display: flex;
    align-items: center;
    justify-content: center;
    color: rgba(255, 255, 255, 0.5);
    font-size: 0.75rem;
    gap: 0.5rem;
}

/* Mobile Features */
.mobile-features {
    display: block;
    margin-top: 2rem;
}

@media (min-width: 1024px) {
    .mobile-features {
        display: none;
    }
}

.mobile-features-title {
    text-align: center;
    color: rgba(255, 255, 255, 0.8);
    font-weight: 600;
    font-size: 1.125rem;
    margin-bottom: 1rem;
}

.mobile-features-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 1rem;
}

.mobile-feature-card {
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(12px);
    border-radius: 0.75rem;
    padding: 1rem;
    text-align: center;
}

.mobile-feature-card i {
    font-size: 1.5rem;
    margin-bottom: 0.5rem;
}

.mobile-feature-card i.blue {
    color: #60a5fa;
}

.mobile-feature-card i.yellow {
    color: #fbbf24;
}

.mobile-feature-card i.green {
    color: #4ade80;
}

.mobile-feature-card i.purple {
    color: #a78bfa;
}

.mobile-feature-card p {
    color: rgba(255, 255, 255, 0.8);
    font-size: 0.875rem;
    font-weight: 500;
}

/* Estilos do app principal */
#app-container {
    display: none;
}

/* Variáveis CSS modernas - Sistema de cores tecnológico */
:root {
    /* Cores principais */
    --primary-50: #eff6ff;
    --primary-100: #dbeafe;
    --primary-200: #bfdbfe;
    --primary-300: #93c5fd;
    --primary-400: #60a5fa;
    --primary-500: #3b82f6;
    --primary-600: #2563eb;
    --primary-700: #1d4ed8;
    --primary-800: #1e40af;
    --primary-900: #1e3a8a;
    
    /* Cores secundárias */
    --secondary-50: #f0f9ff;
    --secondary-100: #e0f2fe;
    --secondary-200: #bae6fd;
    --secondary-300: #7dd3fc;
    --secondary-400: #38bdf8;
    --secondary-500: #0ea5e9;
    --secondary-600: #0284c7;
    --secondary-700: #0369a1;
    --secondary-800: #075985;
    --secondary-900: #0c4a6e;
    
    /* Cores de acento */
    --accent-50: #fdf4ff;
    --accent-100: #fae8ff;
    --accent-200: #f5d0fe;
    --accent-300: #f0abfc;
    --accent-400: #e879f9;
    --accent-500: #d946ef;
    --accent-600: #c026d3;
    --accent-700: #a21caf;
    --accent-800: #86198f;
    --accent-900: #701a75;
    
    /* Cores de sistema */
    --success-50: #f0fdf4;
    --success-500: #10b981;
    --success-600: #059669;
    --warning-50: #fffbeb;
    --warning-500: #f59e0b;
    --warning-600: #d97706;
    --error-50: #fef2f2;
    --error-500: #ef4444;
    --error-600: #dc2626;
    
    /* Cores neutras */
    --neutral-50: #f8fafc;
    --neutral-100: #f1f5f9;
    --neutral-200: #e2e8f0;
    --neutral-300: #cbd5e1;
    --neutral-400: #94a3b8;
    --neutral-500: #64748b;
    --neutral-600: #475569;
    --neutral-700: #334155;
    --neutral-800: #1e293b;
    --neutral-900: #0f172a;
    
    /* Aplicação das cores */
    --primary-color: var(--primary-600);
    --primary-light: var(--primary-400);
    --primary-dark: var(--primary-700);
    --secondary-color: var(--secondary-500);
    --accent-color: var(--accent-500);
    --background-color: var(--neutral-50);
    --background-secondary: var(--neutral-100);
    --card-background: #ffffff;
    --text-color: var(--neutral-800);
    --text-secondary: var(--neutral-600);
    --border-color: var(--neutral-200);
    --success-color: var(--success-500);
    --warning-color: var(--warning-500);
    --danger-color: var(--error-500);
    --info-color: var(--secondary-500);
    --xp-color: var(--accent-600);
    
    /* Dimensões (AJUSTADAS) */
    --sidebar-width: 260px;
    --sidebar-collapsed-width: 70px;
    --header-height: 55px; /* Reduzido */
    
    /* Bordas e raios */
    --border-radius-sm: 6px;
    --border-radius: 10px;
    --border-radius-lg: 16px;
    --border-radius-xl: 20px;
    
    /* Sombras */
    --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
    --shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px -1px rgba(0, 0, 0, 0.1);
    --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
    --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -4px rgba(0, 0, 0, 0.1);
    --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
    --shadow-2xl: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
    
    /* Transições */
    --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    --transition-fast: all 0.15s cubic-bezier(0.4, 0, 0.2, 1);
    --transition-slow: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
}

[data-theme=dark] {
    --background-color: var(--neutral-900);
    --background-secondary: var(--neutral-800);
    --card-background: var(--neutral-800);
    --text-color: var(--neutral-100);
    --text-secondary: var(--neutral-400);
    --border-color: var(--neutral-700);
    --primary-color: var(--primary-400);
    --primary-light: var(--primary-300);
    --primary-dark: var(--primary-500);
    --secondary-color: var(--secondary-400);
    --accent-color: var(--accent-400);
    --xp-color: var(--accent-400);
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-size: 0.9rem; /* Reduzido de 1rem */
    font-family: 'Inter', 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
    background: var(--background-color);
    color: var(--text-color);
    transition: var(--transition);
    overflow-x: hidden;
    line-height: 1.5; /* Reduzido */
    font-weight: 400;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
}

/* Header moderno e tecnológico (AJUSTADO) */
.header-fixed {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    background: rgba(255, 255, 255, 0.8);
    backdrop-filter: blur(20px);
    border-bottom: 1px solid var(--border-color);
    z-index: 1000;
    padding: 8px 20px; /* Reduzido */
    display: flex;
    justify-content: space-between;
    align-items: center;
    transition: var(--transition);
    min-height: var(--header-height);
    box-shadow: var(--shadow-sm);
}

[data-theme=dark] .header-fixed {
    background: rgba(15, 23, 42, 0.8);
    border-bottom-color: var(--border-color);
}

.header-fixed.sidebar-open {
    left: var(--sidebar-width);
}

.header-fixed.sidebar-collapsed {
    left: var(--sidebar-collapsed-width);
}

.header-left {
    display: flex;
    align-items: center;
    gap: 12px; /* Reduzido de 16px */
}

.header-center {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 4px; /* Reduzido */
    margin: 0 16px; /* Reduzido de 24px */
}

.header-right {
    display: flex;
    align-items: center;
    gap: 10px; /* Reduzido */
}

.header-title {
    font-size: 1.2rem; /* Reduzido */
    font-weight: 900;
    background: linear-gradient(135deg, var(--primary-600) 0%, var(--secondary-500) 50%, var(--accent-600) 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    letter-spacing: -0.05em;
    text-shadow: 0 0 30px rgba(59, 130, 246, 0.5);
}

.motivational-quote {
    font-size: 0.8rem; /* Reduzido de 0.9rem */
    font-style: italic;
    color: var(--text-secondary);
    text-align: center;
    max-width: 350px; /* Reduzido de 400px */
    opacity: 0.9;
}

.user-profile-header {
    display: flex;
    align-items: center;
    gap: 10px; /* Reduzido */
    background: var(--card-background);
    padding: 6px 12px; /* Reduzido */
    border-radius: var(--border-radius-lg);
    box-shadow: var(--shadow-md);
    border: 1px solid var(--border-color);
    backdrop-filter: blur(10px);
    transition: var(--transition);
}

.user-profile-header:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-lg);
}

.xp-bar-container {
    width: 100px; /* Reduzido de 120px */
    height: 6px; /* Reduzido */
    background: var(--background-secondary);
    border-radius: 6px;
    overflow: hidden;
    position: relative;
    box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
}

.xp-bar-fill {
    width: 0%;
    height: 100%;
    background: linear-gradient(90deg, var(--accent-500) 0%, var(--primary-500) 50%, var(--secondary-500) 100%);
    transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
    border-radius: inherit;
    position: relative;
    overflow: hidden;
}

.xp-bar-fill::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(90deg, transparent 0%, rgba(255, 255, 255, 0.4) 50%, transparent 100%);
    animation: shimmer 2s infinite;
}

@keyframes shimmer {
    0% { transform: translateX(-100%); }
    100% { transform: translateX(100%); }
}

.user-level {
    font-size: 0.9rem;
    font-weight: 700;
    color: var(--xp-color);
}

.study-streak {
    font-size: 0.9rem; /* Reduzido */
    color: var(--warning-500);
    font-weight: 700; /* Reduzido de 800 */
    display: flex;
    align-items: center;
    gap: 4px; /* Reduzido de 6px */
    background: linear-gradient(135deg, rgba(245, 158, 11, 0.1) 0%, rgba(251, 191, 36, 0.1) 100%);
    padding: 6px 10px; /* Reduzido */
    border-radius: var(--border-radius);
    border: 1px solid rgba(245, 158, 11, 0.3);
    box-shadow: var(--shadow-sm);
    position: relative;
    overflow: hidden;
}

.study-streak::before {
    content: '';
    position: absolute;
    top: -2px;
    left: -2px;
    right: -2px;
    bottom: -2px;
    background: linear-gradient(45deg, #ff6b35, #f7931e, #ffcc02, #ff6b35);
    background-size: 400% 400%;
    animation: gradientShift 3s ease infinite;
    border-radius: inherit;
    z-index: -1;
    opacity: 0.3;
}

@keyframes gradientShift {
    0%, 100% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
}

/* Botões modernos com efeitos tecnológicos (AJUSTADO) */
.btn {
    background: linear-gradient(135deg, var(--primary-600) 0%, var(--primary-700) 100%);
    color: white;
    border: none;
    padding: 10px 18px; /* Reduzido */
    border-radius: var(--border-radius);
    cursor: pointer;
    font-size: 0.9rem; /* Reduzido */
    font-weight: 600;
    transition: var(--transition);
    display: flex;
    align-items: center;
    gap: 8px; /* Reduzido */
    box-shadow: var(--shadow-md);
    border: 1px solid rgba(255, 255, 255, 0.1);
    position: relative;
    overflow: hidden;
    text-decoration: none;
}

.btn::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
    transition: left 0.5s;
}

.btn:hover::before {
    left: 100%;
}

.btn:hover {
    transform: translateY(-3px);
    box-shadow: var(--shadow-xl);
    background: linear-gradient(135deg, var(--primary-700) 0%, var(--primary-800) 100%);
}

.btn:active {
    transform: translateY(-1px);
}

.btn-toggle {
    background: linear-gradient(135deg, var(--warning-500) 0%, var(--warning-600) 100%);
    box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);
}

.btn-toggle:hover {
    background: linear-gradient(135deg, var(--warning-600) 0%, var(--warning-500) 100%);
    box-shadow: 0 8px 20px rgba(245, 158, 11, 0.4);
}

.btn-danger {
    background: linear-gradient(135deg, var(--error-500) 0%, var(--error-600) 100%);
    font-size: 0.8rem; /* Reduzido */
    padding: 8px 14px; /* Reduzido */
    box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
}

.btn-danger:hover {
    background: linear-gradient(135deg, var(--error-600) 0%, var(--error-500) 100%);
    box-shadow: 0 8px 20px rgba(239, 68, 68, 0.4);
}

.btn-ia {
    padding: 6px 10px; /* Reduzido */
    font-size: 0.75rem; /* Reduzido */
    background: linear-gradient(135deg, var(--accent-600) 0%, var(--accent-500) 100%);
    color: white;
    border: none;
    border-radius: var(--border-radius-sm);
    cursor: pointer;
    transition: var(--transition);
    box-shadow: 0 2px 8px rgba(212, 70, 239, 0.3);
    font-weight: 600;
}

.btn-ia:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(212, 70, 239, 0.4);
}

/* Sidebar moderna e elegante (AJUSTADO) */
.sidebar {
    position: fixed;
    top: 0;
    left: 0;
    width: var(--sidebar-width);
    height: 100vh;
    background: linear-gradient(180deg, var(--card-background) 0%, rgba(255, 255, 255, 0.95) 100%);
    backdrop-filter: blur(20px);
    border-right: 1px solid var(--border-color);
    transform: translateX(-100%);
    transition: var(--transition);
    z-index: 999;
    overflow-y: auto;
    padding: 80px 0 24px; /* Ajustado */
    box-shadow: var(--shadow-2xl);
}

[data-theme=dark] .sidebar {
    background: linear-gradient(180deg, var(--card-background) 0%, rgba(30, 41, 59, 0.95) 100%);
}

.sidebar.open {
    transform: translateX(0);
}

.sidebar.collapsed {
    width: var(--sidebar-collapsed-width);
    transform: translateX(0);
}

.sidebar-content {
    padding: 20px; /* Reduzido */
}

.sidebar.collapsed .sidebar-content {
    padding: 16px 10px; /* Reduzido */
}

.sidebar-menu {
    list-style: none;
}

.sidebar-menu li {
    margin-bottom: 4px; /* Reduzido */
}

.sidebar-menu a {
    display: flex;
    align-items: center;
    padding: 12px 16px; /* Reduzido */
    color: var(--text-color);
    text-decoration: none;
    border-radius: var(--border-radius);
    transition: var(--transition);
    gap: 14px; /* Reduzido */
    font-weight: 500;
    position: relative;
    overflow: hidden;
    font-size: 0.9rem; /* Reduzido */
}

.sidebar-menu a::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(135deg, var(--primary-600) 0%, var(--accent-600) 100%);
    opacity: 0;
    transition: var(--transition);
    z-index: -1;
}

.sidebar-menu a:hover::before {
    opacity: 1;
}

.sidebar-menu a:hover {
    color: white;
    transform: translateX(6px);
    box-shadow: var(--shadow-lg);
}

.sidebar-menu i {
    font-size: 1.1rem; /* Reduzido */
    width: 24px; /* Reduzido */
    text-align: center;
    flex-shrink: 0;
    transition: var(--transition);
}

.sidebar-menu a:hover i {
    transform: scale(1.1);
}

.sidebar.collapsed .sidebar-menu span {
    display: none;
}

.sidebar.collapsed .sidebar-menu a {
    justify-content: center;
    padding: 12px; /* Reduzido */
}

/* Conteúdo principal (AJUSTADO) */
.main-content {
    padding-top: calc(var(--header-height) + 24px); /* Aumentado para evitar sobreposição */
    margin-left: 0;
    padding-left: 24px; /* Reduzido de 32px */
    padding-right: 24px; /* Reduzido de 32px */
    padding-bottom: 24px; /* Reduzido de 32px */
    transition: var(--transition);
    min-height: 100vh;
}

.main-content.sidebar-open {
    margin-left: var(--sidebar-width);
}

.main-content.sidebar-collapsed {
    margin-left: var(--sidebar-collapsed-width);
}

.content-section {
    display: none;
}

.content-section.active {
    display: block;
    animation: fadeInUp 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(20px); /* Reduzido */
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* Cards e estatísticas com design tecnológico (AJUSTADO) */
.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); /* Reduzido */
    gap: 20px; /* Reduzido de 28px */
    margin-bottom: 32px; /* Reduzido de 40px */
}

.stat-card {
    background: var(--card-background);
    padding: 20px; /* Reduzido */
    border-radius: var(--border-radius-xl);
    box-shadow: var(--shadow-lg);
    text-align: center;
    transition: var(--transition);
    border: 1px solid var(--border-color);
    position: relative;
    overflow: hidden;
    backdrop-filter: blur(10px);
}

.stat-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(90deg, var(--primary-600) 0%, var(--secondary-500) 50%, var(--accent-600) 100%);
}

.stat-card::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: radial-gradient(circle at center, rgba(59, 130, 246, 0.05) 0%, transparent 70%);
    opacity: 0;
    transition: var(--transition);
    pointer-events: none;
}

.stat-card:hover {
    transform: translateY(-6px) scale(1.02); /* Reduzido */
    box-shadow: var(--shadow-2xl);
}

.stat-card:hover::after {
    opacity: 1;
}

.stat-card h3 {
    color: var(--text-color);
    font-size: 0.95rem; /* Reduzido */
    margin-bottom: 12px; /* Reduzido */
    font-weight: 700;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px; /* Reduzido de 10px */
    opacity: 0.9;
}

.stat-card .value {
    font-size: 2.5rem; /* Reduzido */
    font-weight: 900;
    background: linear-gradient(135deg, var(--primary-600) 0%, var(--secondary-500) 50%, var(--accent-600) 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    margin: 12px 0; /* Reduzido */
    line-height: 1;
    letter-spacing: -0.02em;
}

.stat-card small {
    color: var(--text-secondary);
    font-size: 0.85rem; /* Reduzido */
    font-weight: 500;
}

/* Conquistas com design moderno (AJUSTADO) */
.achievements-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); /* Reduzido */
    gap: 24px; /* Reduzido */
}

.achievement-category {
    background: var(--card-background);
    border-radius: var(--border-radius-xl);
    padding: 24px; /* Reduzido */
    box-shadow: var(--shadow-lg);
    border: 1px solid var(--border-color);
    transition: var(--transition);
    position: relative;
    overflow: hidden;
}

.achievement-category::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: radial-gradient(circle at top right, rgba(212, 70, 239, 0.05) 0%, transparent 50%);
    opacity: 0;
    transition: var(--transition);
}

.achievement-category:hover {
    transform: translateY(-6px);
    box-shadow: var(--shadow-2xl);
}

.achievement-category:hover::before {
    opacity: 1;
}

.achievement-category h3 {
    color: var(--primary-600);
    margin-bottom: 20px; /* Reduzido */
    border-bottom: 2px solid var(--border-color);
    padding-bottom: 12px; /* Reduzido */
    font-weight: 800;
    font-size: 1.2rem; /* Reduzido */
    letter-spacing: -0.02em;
}

.achievement-item {
    display: flex;
    align-items: center;
    gap: 16px; /* Reduzido */
    padding: 16px 0; /* Reduzido */
    border-bottom: 1px solid var(--border-color);
    transition: var(--transition);
    opacity: 0.4;
    border-radius: var(--border-radius);
}

.achievement-item:last-child {
    border-bottom: none;
}

.achievement-item.unlocked {
    opacity: 1;
    background: linear-gradient(135deg, rgba(59, 130, 246, 0.05) 0%, rgba(212, 70, 239, 0.05) 100%);
    padding: 16px; /* Reduzido */
    margin: 10px 0; /* Reduzido */
    border: 1px solid rgba(59, 130, 246, 0.2);
    box-shadow: var(--shadow-sm);
    position: relative;
    overflow: hidden;
}

.achievement-item.unlocked::before {
    content: '';
    position: absolute;
    top: -2px;
    left: -2px;
    right: -2px;
    bottom: -2px;
    background: linear-gradient(135deg, var(--primary-600), var(--accent-600), var(--success-500), var(--warning-500));
    background-size: 400% 400%;
    animation: gradientShift 4s ease infinite;
    border-radius: inherit;
    z-index: -2;
    opacity: 0.3;
}

.achievement-icon {
    font-size: 2.5rem; /* Reduzido */
    color: var(--text-secondary);
    width: 60px; /* Reduzido */
    text-align: center;
    transition: var(--transition);
}

.achievement-item.unlocked .achievement-icon {
    color: var(--primary-600);
    transform: scale(1.2);
    text-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
    filter: drop-shadow(0 0 8px rgba(59, 130, 246, 0.6));
}

.achievement-details h4 {
    margin: 0;
    font-size: 1.1rem; /* Reduzido */
    font-weight: 700;
    color: var(--text-color);
    letter-spacing: -0.02em;
}

.achievement-details p {
    margin: 4px 0 0; /* Reduzido */
    font-size: 0.9rem; /* Reduzido */
    color: var(--text-secondary);
    line-height: 1.5;
}

.achievement-details .unlock-date {
    font-size: 0.8rem;
    font-style: italic;
    color: var(--success-600);
    margin-top: 8px; /* Reduzido */
    font-weight: 600;
}

/* Gráficos com design moderno (AJUSTADO) */
.chart-container {
    background: var(--card-background);
    padding: 24px; /* Reduzido */
    border-radius: var(--border-radius-xl);
    box-shadow: var(--shadow-lg);
    margin-bottom: 32px; /* Reduzido */
    position: relative;
    height: 320px; /* Reduzido */
    border: 1px solid var(--border-color);
    transition: var(--transition);
    backdrop-filter: blur(10px);
}

.chart-container:hover {
    transform: translateY(-4px);
    box-shadow: var(--shadow-2xl);
}

.chart-container h3 {
    text-align: center;
    margin-bottom: 24px; /* Reduzido */
    font-size: 1.2rem; /* Reduzido */
    color: var(--text-color);
    font-weight: 800;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 12px;
    letter-spacing: -0.02em;
}

/* Seções de controle (AJUSTADO) */
.controls-section {
    background: var(--card-background);
    padding: 24px; /* Reduzido */
    border-radius: var(--border-radius-xl);
    box-shadow: var(--shadow-lg);
    margin-bottom: 32px; /* Reduzido */
    border: 1px solid var(--border-color);
    transition: var(--transition);
    backdrop-filter: blur(10px);
}

.controls-section:hover {
    transform: translateY(-4px);
    box-shadow: var(--shadow-2xl);
}

.controls-section h2,
.controls-section h3 {
    color: var(--text-color);
    margin-bottom: 20px; /* Reduzido */
    font-weight: 800;
    display: flex;
    align-items: center;
    gap: 12px; /* Reduzido */
    letter-spacing: -0.02em;
}

.controls-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); /* Reduzido */
    gap: 24px; /* Reduzido */
    align-items: end;
}

/* Inputs modernos com design tecnológico (AJUSTADO) */
.search-box, .filter-select, .config-input {
    width: 100%;
    padding: 12px 18px; /* Reduzido */
    border: 2px solid var(--border-color);
    border-radius: var(--border-radius);
    font-size: 0.95rem; /* Reduzido */
    background: var(--background-color);
    color: var(--text-color);
    transition: var(--transition);
    outline: none;
    font-weight: 500;
}

.search-box:focus, .filter-select:focus, .config-input:focus {
    border-color: var(--primary-600);
    box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1);
    transform: translateY(-2px);
    background: var(--card-background);
}

.config-form {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); /* Reduzido */
    gap: 24px; /* Reduzido */
    margin-top: 24px; /* Reduzido */
}

.config-group {
    display: flex;
    flex-direction: column;
    gap: 8px; /* Reduzido */
}

.config-group label {
    font-weight: 700;
    color: var(--text-color);
    font-size: 0.9rem; /* Reduzido */
    letter-spacing: -0.01em;
}

.config-hint {
    font-size: 0.8rem; /* Reduzido */
    color: var(--text-secondary);
    opacity: 0.8;
    font-style: italic;
}

/* Semanas com design elegante (AJUSTADO) */
.week-section {
    background: var(--card-background);
    border-radius: var(--border-radius-xl);
    box-shadow: var(--shadow-lg);
    margin-bottom: 24px; /* Reduzido */
    overflow: hidden;
    transition: var(--transition);
    border: 1px solid var(--border-color);
    backdrop-filter: blur(10px);
}

.week-section:hover {
    transform: translateY(-4px);
    box-shadow: var(--shadow-2xl);
}

.week-header {
    background: linear-gradient(135deg, var(--primary-600) 0%, var(--secondary-500) 100%);
    color: white;
    padding: 20px 24px; /* Reduzido */
    font-size: 1.2rem; /* Reduzido */
    font-weight: 800;
    display: flex;
    justify-content: space-between;
    align-items: center;
    cursor: pointer;
    transition: var(--transition);
    letter-spacing: -0.02em;
}

.week-header:hover {
    background: linear-gradient(135deg, var(--primary-700) 0%, var(--secondary-600) 100%);
}

.week-content {
    padding: 0;
    max-height: 2000px;
    overflow: hidden;
    transition: max-height 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    overflow-x: auto;
}

.week-content.collapsed {
    max-height: 0;
}

.week-table {
    width: 100%;
    border-collapse: collapse;
    table-layout: fixed;
    font-size: 0.9rem; /* Reduzido */
}

.week-table th {
    background: var(--background-secondary);
    color: var(--text-color);
    padding: 16px 18px; /* Reduzido */
    text-align: left;
    font-weight: 800;
    font-size: 0.85rem; /* Reduzido */
    border-right: 1px solid var(--border-color);
    letter-spacing: 0.02em;
    text-transform: uppercase;
}

.week-table td {
    padding: 16px 18px; /* Reduzido */
    border-bottom: 1px solid var(--border-color);
    border-right: 1px solid var(--border-color);
    vertical-align: top;
    word-wrap: break-word;
    overflow-wrap: break-word;
    transition: var(--transition);
}

.week-table tr:hover {
    background: rgba(59, 130, 246, 0.04);
}

.topic-row {
    display: flex;
    align-items: center;
    gap: 12px; /* Reduzido */
    margin-bottom: 10px; /* Reduzido */
    padding: 10px; /* Reduzido */
    border-radius: var(--border-radius);
    transition: var(--transition);
    background: var(--background-color);
    border: 1px solid transparent;
}

.topic-row:hover {
    background: rgba(59, 130, 246, 0.05);
    border-color: rgba(59, 130, 246, 0.2);
    transform: translateX(4px);
}

.topic-row:last-child {
    margin-bottom: 0;
}

.topic-checkbox {
    transform: scale(1.3); /* Reduzido */
    cursor: pointer;
    flex-shrink: 0;
    accent-color: var(--primary-600);
    transition: var(--transition);
}

.topic-checkbox:checked {
    filter: drop-shadow(0 2px 4px rgba(59, 130, 246, 0.4));
}

.topic-text {
    flex-grow: 1;
    transition: var(--transition);
    font-weight: 600;
    color: var(--text-color);
    font-size: 0.9rem; /* Adicionado */
}

.topic-text.completed {
    /* text-decoration: line-through; */ /* LINHA ALTERADA */
    opacity: 0.6;
    color: var(--success-600);
}

/* Badges de área com design moderno (AJUSTADO) */
.area-badge {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 6px 12px; /* Reduzido */
    border-radius: 20px;
    font-size: 0.7rem; /* Reduzido */
    font-weight: 800;
    color: white;
    flex-shrink: 0;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    box-shadow: var(--shadow-sm);
    transition: var(--transition);
}

.area-badge:hover {
    transform: translateY(-1px);
    box-shadow: var(--shadow-md);
}

.area-preventiva { background: linear-gradient(135deg, #10b981 0%, #059669 100%); }
.area-pediatria { background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); }
.area-ginecologia { background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); }
.area-obstetricia { background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%); }
.area-clinica { background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); }
.area-cirurgia { background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); }
.area-psiquiatria { background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); }
.area-revisao { background: linear-gradient(135deg, #64748b 0%, #475569 100%); }
.area-rest { background: linear-gradient(135deg, #9ca3af 0%, #6b7280 100%); }

.rest-day {
    background: linear-gradient(135deg, #fff7ed 0%, #fed7aa 100%);
    font-style: italic;
    text-align: center;
    color: #9a3412;
    font-weight: 700;
    font-size: 1rem; /* Reduzido */
    letter-spacing: 0.02em;
}

[data-theme=dark] .rest-day {
    background: linear-gradient(135deg, #451a03 0%, #7c2d12 100%);
    color: #fed7aa;
}

/* Modais modernos (AJUSTADO) */
.modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.7);
    backdrop-filter: blur(12px);
    z-index: 2000;
    justify-content: center;
    align-items: center;
    animation: fadeIn 0.4s ease;
}

.modal.active {
    display: flex;
}

.modal-content {
    background: var(--card-background);
    padding: 32px; /* Reduzido */
    border-radius: var(--border-radius-xl);
    max-width: 500px; /* Reduzido */
    width: 90%;
    text-align: center;
    box-shadow: var(--shadow-2xl);
    animation: modalSlideIn 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    border: 1px solid var(--border-color);
    position: relative;
    backdrop-filter: blur(20px);
}

.modal-content h3 {
    color: var(--text-color);
    margin-bottom: 16px; /* Reduzido */
    font-size: 1.4rem; /* Reduzido */
    font-weight: 800;
    letter-spacing: -0.02em;
}

.modal-content p {
    color: var(--text-secondary);
    margin-bottom: 24px; /* Reduzido */
    line-height: 1.6; /* Reduzido */
    font-size: 1rem; /* Reduzido */
}

@keyframes modalSlideIn {
    0% {
        transform: translateY(-50px) scale(0.9); /* Reduzido */
        opacity: 0;
    }
    100% {
        transform: translateY(0) scale(1);
        opacity: 1;
    }
}

/* Botões de dificuldade com design tecnológico (AJUSTADO) */
.difficulty-buttons {
    display: flex;
    gap: 16px; /* Reduzido */
    justify-content: center;
    margin-top: 24px; /* Reduzido */
    flex-wrap: wrap;
}

.difficulty-btn {
    padding: 14px 24px; /* Reduzido */
    border: none;
    border-radius: var(--border-radius);
    cursor: pointer;
    font-weight: 800;
    font-size: 1rem; /* Reduzido */
    transition: var(--transition);
    min-width: 120px; /* Reduzido */
    box-shadow: var(--shadow-md);
    position: relative;
    overflow: hidden;
}

.difficulty-btn::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
    transition: left 0.5s;
}

.difficulty-btn:hover::before {
    left: 100%;
}

.difficulty-easy {
    background: linear-gradient(135deg, var(--success-500) 0%, var(--success-600) 100%);
    color: white;
}

.difficulty-medium {
    background: linear-gradient(135deg, var(--warning-500) 0%, var(--warning-600) 100%);
    color: white;
}

.difficulty-hard {
    background: linear-gradient(135deg, var(--error-500) 0%, var(--error-600) 100%);
    color: white;
}

.difficulty-btn:hover {
    transform: translateY(-4px) scale(1.05);
    box-shadow: var(--shadow-xl);
}

.confirmation-buttons {
    display: flex;
    gap: 20px;
    justify-content: center;
    margin-top: 28px;
}

.btn-confirm {
    background: linear-gradient(135deg, var(--error-500) 0%, var(--error-600) 100%);
}

.btn-cancel {
    background: linear-gradient(135deg, var(--neutral-500) 0%, var(--neutral-600) 100%);
    color: white;
}

/* Notificações com design moderno (AJUSTADO) */
.achievement-notification {
    position: fixed;
    bottom: -200px;
    left: 50%;
    transform: translateX(-50%);
    background: linear-gradient(135deg, var(--warning-500) 0%, var(--warning-600) 100%);
    color: #92400e;
    padding: 20px 28px; /* Reduzido */
    border-radius: var(--border-radius-lg);
    box-shadow: var(--shadow-2xl);
    display: flex;
    align-items: center;
    gap: 16px; /* Reduzido */
    z-index: 9999;
    transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    font-weight: 700;
    max-width: 420px; /* Reduzido */
    border: 1px solid rgba(255, 255, 255, 0.2);
    backdrop-filter: blur(20px);
}

.achievement-notification.show {
    bottom: 32px;
    transform: translateX(-50%) scale(1);
    opacity: 1;
}

.achievement-notification i {
    font-size: 2rem; /* Reduzido */
    color: #92400e;
    filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2));
}

.achievement-notification h4 {
    margin: 0;
    font-size: 1.1rem; /* Reduzido */
    color: #92400e;
    font-weight: 800;
}

.achievement-notification p {
    margin: 4px 0 0; /* Reduzido */
    font-size: 0.9rem; /* Reduzido */
    opacity: 0.9;
    font-weight: 600;
}

/* Progress bars modernos */
.progress-bar {
    background: var(--background-secondary);
    border-radius: 10px;
    height: 10px; /* Reduzido */
    overflow: hidden;
    margin-top: 12px; /* Reduzido */
    position: relative;
    box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
}

.progress-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--primary-600) 0%, var(--secondary-500) 50%, var(--accent-600) 100%);
    border-radius: inherit;
    transition: width 1s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
}

.progress-fill::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(90deg, transparent 0%, rgba(255, 255, 255, 0.4) 50%, transparent 100%);
    animation: shimmer 2.5s infinite;
}

/* Listas de progresso (AJUSTADO) */
.progress-list {
    background: var(--card-background);
    padding: 24px; /* Reduzido */
    border-radius: var(--border-radius-lg);
    box-shadow: var(--shadow-lg);
    margin-bottom: 24px; /* Reduzido */
    border: 1px solid var(--border-color);
    transition: var(--transition);
    backdrop-filter: blur(10px);
}

.progress-list:hover {
    transform: translateY(-4px);
    box-shadow: var(--shadow-2xl);
}

.progress-list h4 {
    color: var(--text-color);
    margin-bottom: 20px; /* Reduzido */
    display: flex;
    align-items: center;
    gap: 12px; /* Reduzido */
    font-weight: 800;
    font-size: 1.1rem; /* Reduzido */
    letter-spacing: -0.02em;
}

.topic-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 16px; /* Reduzido */
    border-bottom: 1px solid var(--border-color);
    transition: var(--transition);
    border-radius: var(--border-radius);
    margin-bottom: 6px;
    background: var(--background-color);
}

.topic-item:hover {
    background: rgba(59, 130, 246, 0.05);
    transform: translateX(6px);
    border-color: rgba(59, 130, 246, 0.2);
}

.topic-item:last-child {
    border-bottom: none;
    margin-bottom: 0;
}

.days-badge {
    background: linear-gradient(135deg, var(--secondary-500) 0%, var(--secondary-600) 100%);
    color: white;
    padding: 6px 12px; /* Reduzido */
    border-radius: 20px;
    font-size: 0.8rem; /* Reduzido */
    font-weight: 800;
    min-width: 65px; /* Reduzido */
    text-align: center;
    box-shadow: var(--shadow-sm);
}

.days-badge.warning {
    background: linear-gradient(135deg, var(--warning-500) 0%, var(--warning-600) 100%);
}

.days-badge.danger {
    background: linear-gradient(135deg, var(--error-500) 0%, var(--error-600) 100%);
}

/* Performance table moderna (AJUSTADO) */
.performance-table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 24px; /* Reduzido */
    font-size: 0.9rem; /* Reduzido */
    background: var(--card-background);
    border-radius: var(--border-radius-lg);
    overflow: hidden;
    box-shadow: var(--shadow-lg);
}

.performance-table th,
.performance-table td {
    padding: 14px 16px; /* Reduzido */
    border-bottom: 1px solid var(--border-color);
    text-align: left;
}

.performance-table th {
    background: linear-gradient(135deg, var(--primary-600) 0%, var(--secondary-500) 100%);
    color: white;
    font-weight: 800;
    font-size: 0.85rem; /* Reduzido */
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.performance-table tr {
    transition: var(--transition);
}

.performance-table tr:hover {
    background: rgba(59, 130, 246, 0.05);
    transform: scale(1.01);
}

.performance-table .percentage-col {
    font-weight: 800;
    font-size: 1rem; /* Reduzido */
}

.performance-table .percentage-col.good {
    color: var(--success-600);
}

.performance-table .percentage-col.medium {
    color: var(--warning-600);
}

.performance-table .percentage-col.bad {
    color: var(--error-600);
}

/* Pomodoro com design tecnológico (AJUSTADO) */
.pomodoro-section {
    background: var(--card-background);
    padding: 32px; /* Reduzido */
    border-radius: var(--border-radius-xl);
    box-shadow: var(--shadow-lg);
    margin-bottom: 32px; /* Reduzido */
    text-align: center;
    border: 1px solid var(--border-color);
    transition: var(--transition);
    backdrop-filter: blur(10px);
}

.pomodoro-section:hover {
    transform: translateY(-4px);
    box-shadow: var(--shadow-2xl);
}

.pomodoro-display {
    font-size: 4rem; /* Reduzido */
    font-weight: 900;
    background: linear-gradient(135deg, var(--primary-600) 0%, var(--secondary-500) 50%, var(--accent-600) 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    margin: 32px 0; /* Reduzido */
    font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', monospace;
    letter-spacing: 4px; /* Reduzido */
    text-shadow: 0 0 30px rgba(59, 130, 246, 0.5);
}

.pomodoro-controls {
    display: flex;
    gap: 16px; /* Reduzido */
    justify-content: center;
    flex-wrap: wrap;
    margin-top: 28px; /* Reduzido */
}

.pomodoro-settings {
    display: flex;
    gap: 20px; /* Reduzido */
    justify-content: center;
    margin-top: 28px; /* Reduzido */
    flex-wrap: wrap;
}

.pomodoro-settings > div {
    display: flex;
    flex-direction: column;
    gap: 8px; /* Reduzido */
    align-items: center;
}

.pomodoro-settings label {
    font-weight: 700;
    color: var(--text-color);
    font-size: 0.9rem; /* Reduzido */
    letter-spacing: -0.01em;
}

.pomodoro-settings input {
    width: 80px; /* Reduzido */
    padding: 10px; /* Reduzido */
    border: 2px solid var(--border-color);
    border-radius: var(--border-radius);
    text-align: center;
    background: var(--background-color);
    color: var(--text-color);
    font-weight: 700;
    transition: var(--transition);
    font-size: 1rem;
}

.pomodoro-settings input:focus {
    border-color: var(--primary-600);
    box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1);
}

/* CHATBOT MÉDICO com design futurístico (AJUSTADO) */
.medical-chatbot {
    position: fixed;
    bottom: 24px; /* Reduzido */
    right: 24px; /* Reduzido */
    z-index: 2000; /* Aumentado de 1500 para garantir visibilidade */
    font-family: inherit;
}

.chatbot-toggle {
    width: 60px; /* Reduzido */
    height: 60px; /* Reduzido */
    border-radius: 50%;
    background: linear-gradient(135deg, var(--accent-600) 0%, var(--accent-500) 100%);
    border: none;
    color: white;
    font-size: 1.6rem; /* Reduzido */
    cursor: pointer;
    box-shadow: var(--shadow-xl);
    transition: var(--transition);
    display: flex;
    align-items: center;
    justify-content: center;
    border: 3px solid rgba(255, 255, 255, 0.2);
    backdrop-filter: blur(10px);
    position: relative;
    overflow: hidden;
}

.chatbot-toggle::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: radial-gradient(circle at center, rgba(255, 255, 255, 0.3) 0%, transparent 70%);
    opacity: 0;
    transition: var(--transition);
}

.chatbot-toggle:hover::before {
    opacity: 1;
}

.chatbot-toggle:hover {
    transform: scale(1.1) translateY(-4px);
    box-shadow: var(--shadow-2xl);
}

.chatbot-toggle.active {
    background: linear-gradient(135deg, var(--error-500) 0%, var(--error-600) 100%);
    box-shadow: 0 8px 32px rgba(239, 68, 68, 0.5);
}

.chatbot-container {
    position: absolute;
    bottom: 80px; /* Reduzido */
    right: 0;
    width: 350px; /* Reduzido de 380px */
    height: 500px; /* Reduzido de 550px */
    background: var(--card-background);
    border-radius: var(--border-radius-xl);
    box-shadow: var(--shadow-2xl);
    display: none;
    flex-direction: column;
    overflow: hidden;
    border: 1px solid var(--border-color);
    backdrop-filter: blur(20px);
}

.chatbot-container.active {
    display: flex;
    animation: slideInUp 0.5s cubic-bezier(0.4, 0, 0.2, 1);
}

@keyframes slideInUp {
    from {
        opacity: 0;
        transform: translateY(30px) scale(0.95);
    }
    to {
        opacity: 1;
        transform: translateY(0) scale(1);
    }
}

.chatbot-header {
    background: linear-gradient(135deg, var(--primary-600) 0%, var(--primary-700) 100%); /* Mudado para cores do cronograma */
    color: white;
    padding: 15px 20px; /* Reduzido de 28px */
    font-size: 0.9rem; /* Adicionado para reduzir o tamanho da fonte */
    text-align: center;
    position: relative;
    flex-shrink: 0; /* CORREÇÃO */
}

.chatbot-header h3 {
    margin: 0;
    font-size: 1.1rem; /* Reduzido */
    font-weight: 700; /* Reduzido de 800 */
    letter-spacing: -0.02em;
}

.chatbot-header p {
    margin: 4px 0 0 0; /* Reduzido */
    font-size: 0.8rem; /* Reduzido */
    opacity: 0.9;
    font-weight: 500;
}

.chatbot-close {
    position: absolute;
    top: 12px; /* Reduzido */
    right: 12px; /* Reduzido */
    background: rgba(255, 255, 255, 0.2);
    border: none;
    color: white;
    font-size: 1.2rem; /* Reduzido */
    cursor: pointer;
    opacity: 0.8;
    width: 28px; /* Reduzido */
    height: 28px; /* Reduzido */
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: var(--transition);
    backdrop-filter: blur(10px);
}

.chatbot-close:hover {
    opacity: 1;
    background: rgba(255, 255, 255, 0.3);
    transform: scale(1.1);
}

.chat-messages {
    flex: 1;
    padding: 20px; /* Reduzido */
    overflow-y: auto;
    background: var(--background-color);
}

.chat-messages::-webkit-scrollbar {
    width: 8px;
}

.chat-messages::-webkit-scrollbar-track {
    background: transparent;
}

.chat-messages::-webkit-scrollbar-thumb {
    background: var(--border-color);
    border-radius: 4px;
}

.message {
    margin-bottom: 16px; /* Reduzido */
    max-width: 85%;
    animation: fadeInUp 0.4s ease;
}

.message.user {
    margin-left: auto;
    text-align: right;
}

.message.bot {
    margin-right: auto;
}

.message-bubble {
    padding: 12px 18px; /* Reduzido */
    border-radius: 20px;
    font-size: 0.9rem; /* Reduzido */
    line-height: 1.5; /* Reduzido */
    word-wrap: break-word;
    box-shadow: var(--shadow-md);
    font-weight: 500;
}

.message.user .message-bubble {
    background: linear-gradient(135deg, var(--accent-600) 0%, var(--accent-500) 100%);
    color: white;
    border-bottom-right-radius: 8px;
}

.message.bot .message-bubble {
    background: var(--card-background);
    color: var(--text-color);
    border: 1px solid var(--border-color);
    border-bottom-left-radius: 8px;
}

.message-time {
    font-size: 0.75rem;
    opacity: 0.7;
    margin-top: 6px; /* Reduzido */
    color: var(--text-secondary);
    font-weight: 500;
}

.typing-indicator {
    display: none;
    align-items: center;
    gap: 12px;
    padding: 12px 18px; /* Reduzido */
    background: var(--card-background);
    border: 1px solid var(--border-color);
    border-radius: 20px;
    border-bottom-left-radius: 8px;
    margin-bottom: 16px; /* Reduzido */
    max-width: 85%;
    box-shadow: var(--shadow-md);
}

.typing-indicator.active {
    display: flex;
    animation: fadeInUp 0.4s ease;
}

.typing-dots {
    display: flex;
    gap: 4px;
}

.typing-dot {
    width: 8px; /* Reduzido */
    height: 8px; /* Reduzido */
    background: var(--accent-600);
    border-radius: 50%;
    animation: typingAnimation 1.4s infinite ease-in-out;
}

.typing-dot:nth-child(1) { animation-delay: -0.32s; }
.typing-dot:nth-child(2) { animation-delay: -0.16s; }

@keyframes typingAnimation {
    0%, 80%, 100% {
        transform: scale(0.8);
        opacity: 0.5;
    }
    40% {
        transform: scale(1);
        opacity: 1;
    }
}

.chat-input-container {
    padding: 20px; /* Reduzido */
    border-top: 1px solid var(--border-color);
    background: var(--card-background);
}

.chat-input-wrapper {
    display: flex;
    gap: 12px; /* Reduzido */
    align-items: flex-end;
}

.chat-input {
    flex: 1;
    padding: 12px 18px; /* Reduzido */
    border: 2px solid var(--border-color);
    border-radius: 24px;
    background: var(--background-color);
    color: var(--text-color);
    font-size: 0.9rem; /* Reduzido */
    resize: none;
    max-height: 100px; /* Reduzido */
    min-height: 42px; /* Reduzido */
    outline: none;
    transition: var(--transition);
    font-family: inherit;
    font-weight: 500;
}

.chat-input:focus {
    border-color: var(--accent-600);
    box-shadow: 0 0 0 4px rgba(212, 70, 239, 0.1);
}

.chat-send {
    width: 42px; /* Reduzido */
    height: 42px; /* Reduzido */
    border-radius: 50%;
    background: linear-gradient(135deg, var(--accent-600) 0%, var(--accent-500) 100%);
    border: none;
    color: white;
    font-size: 1.1rem; /* Reduzido */
    cursor: pointer;
    transition: var(--transition);
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: var(--shadow-md);
}

.chat-send:hover:not(:disabled) {
    background: linear-gradient(135deg, var(--accent-700) 0%, var(--accent-600) 100%);
    transform: scale(1.05);
    box-shadow: var(--shadow-lg);
}

.chat-send:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.quick-topics {
    display: flex;
    flex-wrap: wrap;
    gap: 8px; /* Reduzido */
    margin-bottom: 16px; /* Reduzido */
}

.quick-topic {
    padding: 8px 14px; /* Reduzido */
    background: var(--card-background);
    border: 1px solid var(--border-color);
    border-radius: 20px;
    font-size: 0.8rem; /* Reduzido */
    cursor: pointer;
    transition: var(--transition);
    color: var(--text-color);
    font-weight: 600;
    box-shadow: var(--shadow-sm);
}

.quick-topic:hover {
    background: linear-gradient(135deg, var(--accent-600) 0%, var(--accent-500) 100%);
    color: white;
    border-color: var(--accent-600);
    transform: translateY(-2px);
    box-shadow: var(--shadow-md);
}

.error-message {
    background: linear-gradient(135deg, var(--error-50) 0%, #fecaca 100%);
    color: var(--error-600);
    padding: 12px 18px; /* Reduzido */
    border-radius: 20px;
    border-bottom-left-radius: 8px;
    font-size: 0.9rem; /* Reduzido */
    margin-bottom: 16px; /* Reduzido */
    max-width: 85%;
    border: 1px solid #fca5a5;
    font-weight: 500;
}

[data-theme=dark] .error-message {
    background: linear-gradient(135deg, #7f1d1d 0%, #991b1b 100%);
    color: #fca5a5;
    border-color: #991b1b;
}

/* GAMIFICAÇÃO com design tecnológico (AJUSTADO) */
.level-container {
    display: flex;
    align-items: center;
    gap: 12px; /* Reduzido */
    margin-bottom: 8px; /* Reduzido */
}

.level-avatar {
    font-size: 1.5rem; /* Reduzido */
    width: 40px; /* Reduzido */
    height: 40px; /* Reduzido */
    display: flex;
    align-items: center;
    justify-content: center;
    background: linear-gradient(135deg, var(--accent-600) 0%, var(--accent-500) 100%);
    border-radius: 50%;
    color: white;
    border: 3px solid rgba(255, 255, 255, 0.2);
    box-shadow: var(--shadow-lg);
    transition: var(--transition);
}

.level-avatar:hover {
    transform: scale(1.1);
}

.level-progress {
    flex-grow: 1;
}

.level-info {
    font-size: 0.8rem;
    color: var(--text-secondary);
    margin-top: 4px; /* Reduzido */
    font-weight: 500;
}

.level-badge {
    background: linear-gradient(135deg, var(--accent-600) 0%, var(--accent-500) 100%);
    color: white;
    padding: 4px 10px; /* Reduzido */
    border-radius: 16px;
    font-size: 0.7rem; /* Reduzido */
    font-weight: 800;
    display: inline-block;
    margin-left: 8px; /* Reduzido */
    box-shadow: var(--shadow-sm);
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.level-up-animation {
    animation: levelUp 0.8s cubic-bezier(0.4, 0, 0.2, 1);
}

@keyframes levelUp {
    0% { transform: scale(1); }
    30% { transform: scale(1.3) rotate(10deg); }
    60% { transform: scale(1.1) rotate(-5deg); }
    100% { transform: scale(1.2) rotate(0deg); }
}

.level-up-notification {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: var(--card-background);
    padding: 32px; /* Reduzido */
    border-radius: var(--border-radius-xl);
    box-shadow: var(--shadow-2xl);
    z-index: 9999;
    opacity: 0;
    transition: opacity 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    text-align: center;
    max-width: 360px; /* Reduzido */
    width: 90%;
    border: 1px solid var(--border-color);
    backdrop-filter: blur(20px);
}

.level-up-notification.show {
    opacity: 1;
    animation: celebrationPulse 0.8s ease;
}

@keyframes celebrationPulse {
    0%, 100% { transform: translate(-50%, -50%) scale(1); }
    25% { transform: translate(-50%, -50%) scale(1.05); }
    50% { transform: translate(-50%, -50%) scale(1.1); }
    75% { transform: translate(-50%, -50%) scale(1.05); }
}

.level-up-content {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 16px; /* Reduzido */
}

.level-up-content h3 {
    color: var(--primary-600);
    margin: 0;
    font-size: 1.4rem; /* Reduzido */
    font-weight: 900;
    letter-spacing: -0.02em;
}

.level-up-content h4 {
    color: var(--text-color);
    margin: 0;
    font-size: 1.2rem; /* Reduzido */
    font-weight: 700;
    letter-spacing: -0.02em;
}

.level-up-content p {
    color: var(--text-secondary);
    margin: 0;
    font-size: 0.9rem; /* Reduzido */
    font-weight: 500;
}

/* Responsividade aprimorada */
@media (max-width: 1200px) {
    .header-center {
        display: none;
    }
    
    .stats-grid {
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 16px;
    }
}

@media (max-width: 768px) {
    .header-fixed {
        left: 0 !important;
        padding: 12px 16px; /* Reduzido */
        flex-direction: column;
        min-height: auto;
        gap: 12px; /* Reduzido */
    }
    
    .header-left,
    .header-right {
        width: 100%;
        justify-content: space-between;
    }
    
    .header-center {
        display: flex;
        width: 100%;
        order: -1;
        margin: 12px 0;
    }
    
    .user-profile-header {
        width: 100%;
        justify-content: center;
        gap: 12px; /* Reduzido */
        padding: 8px 12px; /* Reduzido */
    }
    
    .xp-bar-container {
        width: 120px; /* Reduzido */
        height: 6px; /* Reduzido */
    }
    
    .sidebar {
        width: 100%;
        transform: translateX(-100%);
    }
    
    .sidebar.open {
        transform: translateX(0);
        width: 280px; /* Reduzido */
    }
    
    .sidebar.collapsed {
        transform: translateX(-100%);
    }
    
    .main-content.sidebar-open,
    .main-content.sidebar-collapsed {
        margin-left: 0;
    }
    
    .main-content {
        padding-top: 180px; /* Ajustado para o header mobile maior */
        padding-left: 16px; /* Reduzido */
        padding-right: 16px; /* Reduzido */
    }
    
    .stats-grid {
        grid-template-columns: 1fr;
        gap: 16px; /* Reduzido */
    }
    
    .controls-grid,
    .config-form {
        grid-template-columns: 1fr;
    }
    
    .pomodoro-controls,
    .difficulty-buttons {
        flex-direction: column;
        align-items: center;
    }
    
    .week-table {
        font-size: 0.8rem; /* Reduzido */
    }
    
    .week-table th,
    .week-table td {
        padding: 12px 10px; /* Reduzido */
    }
    
    .chatbot-container {
        width: 100vw;
        height: 100vh;
        bottom: 0;
        right: 0;
        border-radius: 0;
        position: fixed;
    }
    
    .medical-chatbot {
        bottom: 20px;
        right: 20px;
    }
    
    .chatbot-toggle {
        width: 55px; /* Reduzido */
        height: 55px; /* Reduzido */
        font-size: 1.5rem; /* Reduzido */
    }
    
    .auth-form {
        padding: 24px; /* Reduzido */
        margin: 20px;
    }
    
    .achievements-grid {
        grid-template-columns: 1fr;
        gap: 16px; /* Reduzido */
    }
    
    .achievement-category {
        padding: 20px; /* Reduzido */
    }
    
    .chart-container {
        padding: 20px; /* Reduzido */
        height: 280px; /* Reduzido */
    }
    
    .controls-section {
        padding: 20px; /* Reduzido */
    }
    
    .pomodoro-section {
        padding: 28px; /* Reduzido */
    }
    
    .pomodoro-display {
        font-size: 3rem; /* Reduzido */
        letter-spacing: 3px;
    }
}

@media (max-width: 480px) {
    .header-title {
        font-size: 1.2rem; /* Reduzido */
    }
    
    .pomodoro-display {
        font-size: 2.5rem; /* Reduzido */
    }
    
    .stat-card .value {
        font-size: 2.5rem; /* Reduzido */
    }
    
    .achievement-icon {
        font-size: 2.2rem; /* Reduzido */
        width: 50px; /* Reduzido */
    }
    
    .difficulty-buttons {
        flex-direction: column;
        align-items: stretch;
    }
    
    .difficulty-btn {
        width: 100%;
        margin-bottom: 10px;
    }
}

/* Scrollbar personalizada moderna */
::-webkit-scrollbar {
    width: 8px; /* Reduzido */
}

::-webkit-scrollbar-track {
    background: var(--background-color);
    border-radius: 6px;
}

::-webkit-scrollbar-thumb {
    background: linear-gradient(135deg, var(--primary-600) 0%, var(--secondary-500) 100%);
    border-radius: 6px;
    transition: var(--transition);
}

::-webkit-scrollbar-thumb:hover {
    background: linear-gradient(135deg, var(--primary-700) 0%, var(--secondary-600) 100%);
}

/* Grupos de revisão modernos (AJUSTADO) */
.review-group {
    background: var(--card-background);
    padding: 24px; /* Reduzido */
    border-radius: var(--border-radius-lg);
    margin-bottom: 20px; /* Reduzido */
    box-shadow: var(--shadow-lg);
    border: 1px solid var(--border-color);
    transition: var(--transition);
    backdrop-filter: blur(10px);
}

.review-group:hover {
    transform: translateY(-4px);
    box-shadow: var(--shadow-2xl);
}

.review-group h4 {
    color: var(--primary-600);
    margin-bottom: 16px; /* Reduzido */
    display: flex;
    align-items: center;
    gap: 10px; /* Reduzido */
    font-weight: 800;
    font-size: 1.1rem; /* Reduzido */
    letter-spacing: -0.02em;
}

.review-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 14px 18px; /* Reduzido */
    border-bottom: 1px solid var(--border-color);
    border-radius: var(--border-radius);
    margin-bottom: 8px; /* Reduzido */
    transition: var(--transition);
    background: var(--background-color);
}

.review-item:hover {
    background: rgba(59, 130, 246, 0.05);
    transform: translateX(6px);
    border-color: rgba(59, 130, 246, 0.2);
}

.review-item:last-child {
    border-bottom: none;
    margin-bottom: 0;
}

.review-info {
    flex-grow: 1;
}

.review-info strong {
    color: var(--text-color);
    font-weight: 700;
    font-size: 1rem; /* Reduzido */
    letter-spacing: -0.01em;
}

.review-info div {
    color: var(--text-secondary);
    font-size: 0.85rem; /* Reduzido */
    margin-top: 4px; /* Reduzido */
    font-weight: 500;
}

.review-actions {
    display: flex;
    gap: 12px; /* Reduzido */
    align-items: center;
}

.review-due {
    font-weight: 800;
    padding: 6px 14px; /* Reduzido */
    border-radius: 16px;
    font-size: 0.8rem; /* Reduzido */
    min-width: 80px; /* Reduzido */
    text-align: center;
    box-shadow: var(--shadow-sm);
}

.review-due.urgent {
    background: linear-gradient(135deg, var(--error-500) 0%, var(--error-600) 100%);
    color: white;
}

.review-due.soon {
    background: linear-gradient(135deg, var(--warning-500) 0%, var(--warning-600) 100%);
    color: white;
}

.review-due:not(.urgent):not(.soon) {
    background: linear-gradient(135deg, var(--success-500) 0%, var(--success-600) 100%);
    color: white;
}

/* Lista de temas customizados */
.custom-theme-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 18px; /* Reduzido */
    border-radius: var(--border-radius);
    background: var(--background-color);
    margin-bottom: 10px;
    border: 1px solid var(--border-color);
    transition: var(--transition);
}

.custom-theme-item:hover {
    background: rgba(59, 130, 246, 0.05);
    transform: translateX(6px);
    border-color: rgba(59, 130, 246, 0.2);
}

.custom-theme-item span {
    display: flex;
    align-items: center;
    gap: 12px; /* Reduzido */
    font-weight: 600;
}

/* Efeitos especiais para elementos interativos */
.btn, .difficulty-btn, .chatbot-toggle, .topic-checkbox {
    position: relative;
    overflow: hidden;
}

/* Display de tempo de estudo (AJUSTADO) */
#study-time-display {
    background: rgba(6, 182, 212, 0.1);
    padding: 8px 14px; /* Reduzido */
    border-radius: var(--border-radius);
    border: 1px solid rgba(6, 182, 212, 0.3);
    font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', monospace;
    letter-spacing: 1px;
    box-shadow: var(--shadow-sm);
    backdrop-filter: blur(10px);
    font-size: 0.9rem; /* Adicionado */
}

/* Grupo de formulários de configuração */
.config-form-group {
    display: flex;
    gap: 16px;
    align-items: flex-end;
    background: var(--background-color);
    padding: 20px;
    border-radius: var(--border-radius);
    border: 1px solid var(--border-color);
}

.config-form-group > div {
    flex-grow: 1;
}

.config-form-group .btn {
    white-space: nowrap;
    min-width: 140px;
}

/* Estados de foco melhorados */
*:focus {
    outline: 2px solid var(--primary-600);
    outline-offset: 2px;
}

button:focus, input:focus, select:focus, textarea:focus {
    outline: none;
    box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1);
}

/* Estados disabled melhorados */
button:disabled, input:disabled, select:disabled, textarea:disabled {
    opacity: 0.6;
    cursor: not-allowed;
    filter: grayscale(20%);
}

/* Transições suaves para mudanças de tema */
*, *::before, *::after {
    transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease, box-shadow 0.3s ease;
}

/* Melhorias na tipografia (AJUSTADO) */
h1, h2, h3, h4, h5, h6 {
    font-weight: 800;
    line-height: 1.2;
    letter-spacing: -0.025em;
}

h1 { font-size: 2.2rem; }
h2 { font-size: 1.8rem; }
h3 { font-size: 1.5rem; }
h4 { font-size: 1.25rem; }
h5 { font-size: 1.1rem; }
h6 { font-size: 1rem; }

/* Animações de carregamento */
@keyframes skeletonPulse {
    0%, 100% {
        opacity: 1;
    }
    50% {
        opacity: 0.4;
    }
}

.loading {
    animation: skeletonPulse 1.5s ease-in-out infinite;
}

/* Efeitos especiais para checkboxes */
.topic-checkbox:checked {
    transform: scale(1.3); /* Reduzido */
    filter: drop-shadow(0 2px 4px rgba(59, 130, 246, 0.4));
}

/* Melhorias finais nos elementos pequenos */
.expand-weeks-btn {
    margin-bottom: 24px;
    background: linear-gradient(135deg, var(--secondary-500) 0%, var(--secondary-600) 100%);
}

/* Fade-in class para animações */
.fade-in {
    animation: fadeInUp 0.8s cubic-bezier(0.4, 0, 0.2, 1);
}

@keyframes hourglass-spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(180deg); }
}

.loading-hourglass {
  display: inline-block;
  animation: hourglass-spin 1.5s ease-in-out infinite;
}

/* Estilo do modal do flashcard IA */
#ia-flashcard-modal .modal-content {
  max-height: 80vh; /* 80% da altura da tela */
  overflow-y: auto; /* Habilita scroll vertical quando necessário */
  padding: 20px;
  text-align: left;
}

#ia-resumo {
  white-space: pre-wrap; /* Mantém quebras de linha e formatação */
  max-height: 60vh; /* Altura máxima antes do scroll */
  overflow-y: auto;
  padding: 10px;
  background-color: var(--card-background);
  border-radius: var(--border-radius);
  border: 1px solid var(--border-color);
  margin: 15px 0;
}

/* Pulse class para elementos especiais */
.pulse {
    animation: pulse 2s infinite;
}

@keyframes pulse {
    0% {
        transform: scale(1);
    }
    50% {
        transform: scale(1.05);
    }
    100% {
        transform: scale(1);
    }
}
    </style>
</head>
<body>
    <div id="auth-container">
        <div class="blob-1"></div>
        <div class="blob-2"></div>
        <div class="blob-3"></div>
        
        <div class="grid-overlay"></div>

        <div class="content-container">
            <div class="marketing-content">
                <div class="header-section">
                    <div class="brand-header">
                        <div class="brand-icon">
                            <i class="fas fa-graduation-cap"></i>
                        </div>
                        <div>
                            <h1 class="brand-title">Cronograma Revalida 2025</h1>
                            <p class="brand-subtitle">Sua jornada médica começa aqui</p>
                        </div>
                    </div>
                    
                    <div class="features-list">
                        <div class="feature-item">
                            <div class="feature-icon green">
                                <i class="fas fa-check"></i>
                            </div>
                            <div>
                                <h3 class="feature-title">Organize seus estudos com inteligência</h3>
                                <p class="feature-description">Cronograma personalizado para sua aprovação</p>
                            </div>
                        </div>
                        
                        <div class="feature-item">
                            <div class="feature-icon blue">
                                <i class="fas fa-brain"></i>
                            </div>
                            <div>
                                <h3 class="feature-title">IA especializada em medicina</h3>
                                <p class="feature-description">Chatbot médico para esclarecer dúvidas</p>
                            </div>
                        </div>
                        
                        <div class="feature-item">
                            <div class="feature-icon purple">
                                <i class="fas fa-trophy"></i>
                            </div>
                            <div>
                                <h3 class="feature-title">Sistema de gamificação</h3>
                                <p class="feature-description">Conquistas e níveis para manter motivação</p>
                            </div>
                        </div>
                        
                        <div class="feature-item">
                            <div class="feature-icon orange">
                                <i class="fas fa-clock"></i>
                            </div>
                            <div>
                                <h3 class="feature-title">Acesse de qualquer lugar</h3>
                                <p class="feature-description">Sincronização automática na nuvem</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="stats-section">
                    <div class="stat-item">
                        <div class="stat-number blue">500+</div>
                        <div class="stat-label">Temas Médicos</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number purple">95%</div>
                        <div class="stat-label">Taxa de Aprovação</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number pink">24/7</div>
                        <div class="stat-label">Acesso Total</div>
                    </div>
                </div>
            </div>

            <div class="auth-container">
                <div class="auth-form-wrapper">
                    
                    <div class="auth-toggle">
                        <div class="toggle-container">
                            <button id="login-toggle" class="toggle-button active">
                                <i class="fas fa-sign-in-alt"></i>
                                Entrar
                            </button>
                            <button id="signup-toggle" class="toggle-button inactive">
                                <i class="fas fa-user-plus"></i>
                                Cadastrar
                            </button>
                        </div>
                    </div>

                    <div class="auth-form">
                        <div class="form-header">
                            <div class="form-icon">
                                <i id="form-icon" class="fas fa-stethoscope"></i>
                            </div>
                            <h2 id="auth-title" class="form-title">Bem-vindo de volta!</h2>
                            <p id="form-subtitle" class="form-subtitle">Continue seus estudos de onde parou</p>
                        </div>

                        <div class="form-fields">
                             <div class="field-group" id="username-group">
                                <div class="field-icon">
                                    <i class="fas fa-user"></i>
                                </div>
                                <input
                                    type="text"
                                    id="username"
                                    class="form-input"
                                    placeholder="Seu nome de usuário"
                                />
                            </div>

                            <div class="field-group">
                                <div class="field-icon">
                                    <i class="fas fa-envelope"></i>
                                </div>
                                <input
                                    type="email"
                                    id="email"
                                    class="form-input"
                                    placeholder="Seu e-mail"
                                    required
                                />
                            </div>

                            <div class="field-group">
                                <div class="field-icon">
                                    <i class="fas fa-lock"></i>
                                </div>
                                <input
                                    type="password"
                                    id="password"
                                    class="form-input"
                                    placeholder="Sua senha"
                                    required
                                />
                            </div>

                            <button id="auth-button" class="submit-button">
                                <i id="submit-icon" class="fas fa-sign-in-alt"></i>
                                <span id="submit-text">Entrar</span>
                            </button>
                        </div>

                        <div class="form-footer">
                            <p id="auth-switch">
                                <span id="footer-text">Não tem uma conta?</span>
                                <a id="switch-to-signup">Cadastre-se</a>
                            </p>
                        </div>

                        <div class="security-badge">
                            <i class="fas fa-shield-alt"></i>
                            <span>Seus dados estão protegidos com criptografia de ponta</span>
                        </div>
                    </div>

                    <div class="mobile-features">
                        <div class="mobile-features-title">
                            <h3>Por que escolher nossa plataforma?</h3>
                        </div>
                        <div class="mobile-features-grid">
                            <div class="mobile-feature-card">
                                <i class="fas fa-brain blue"></i>
                                <p>IA Médica</p>
                            </div>
                            <div class="mobile-feature-card">
                                <i class="fas fa-trophy yellow"></i>
                                <p>Gamificação</p>
                            </div>
                            <div class="mobile-feature-card">
                                <i class="fas fa-clock green"></i>
                                <p>Pomodoro</p>
                            </div>
                            <div class="mobile-feature-card">
                                <i class="fas fa-chart-line purple"></i>
                                <p>Analytics</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="app-container">
        <header class="header-fixed" id="header">
            <div class="header-left">
                <button class="btn" id="menu-toggle"><i class="fas fa-bars"></i></button>
                <div class="header-title">Revalida 2025</div>
            </div>
            <div class="header-center">
                 <div class="user-profile-header">
                    <div id="study-streak" class="study-streak" title="Dias de estudo consecutivos"><i class="fas fa-fire"></i> <span id="streak-count">0</span></div>
                    <div class="user-level" id="user-level"></div>
                    <div class="xp-bar-container" title="Pontos de Experiência"><div id="xp-bar-fill" class="xp-bar-fill"></div></div>
                </div>
            </div>
            <div class="header-right">
        <div id="study-time-display" title="Tempo total de estudo" style="font-weight: 600; color: var(--accent-color);">
            ⏱️ 00:00:00
        </div>
        <button class="btn btn-toggle" id="theme-toggle" title="Alternar Modo Escuro/Claro">
            <i class="fas fa-moon"></i>
        </button>
        <button class="btn" id="minimalist-toggle" title="Modo Minimalista">
            <i class="fas fa-compress"></i>
        </button>
        <button class="btn btn-danger" id="logout-btn" title="Sair">
            <i class="fas fa-sign-out-alt"></i>
        </button>
    </div>
        </header>

        <nav class="sidebar" id="sidebar">
            <div class="sidebar-content">
                <ul class="sidebar-menu">
                    <li><a href="#" data-section="stats"><i class="fas fa-chart-bar"></i><span>Estatísticas</span></a></li>
                    <li><a href="#" data-section="achievements"><i class="fas fa-trophy"></i><span>Conquistas</span></a></li>
                    <li><a href="#" data-section="performance"><i class="fas fa-chart-line"></i><span>Desempenho por Questões</span></a></li>
                    <li><a href="#" data-section="progress"><i class="fas fa-tasks"></i><span>Progresso</span></a></li>
                    <li><a href="#" data-section="pomodoro"><i class="fas fa-clock"></i><span>Pomodoro</span></a></li>
                    <li><a href="#" data-section="review"><i class="fas fa-brain"></i><span>Revisão</span></a></li>
                    <li><a href="#" data-section="weeks"><i class="fas fa-calendar"></i><span>Semanas</span></a></li>
                    <li><a href="#" data-section="settings"><i class="fas fa-cog"></i><span>Configurações</span></a></li>
                    <li><a href="#" id="reset-progress"><i class="fas fa-trash"></i><span>Resetar</span></a></li>
                </ul>
            </div>
        </nav>

        <main class="main-content" id="main-content">
            <section id="stats-section" class="content-section active">
                <div class="stats-grid fade-in">
                    <div class="stat-card"><h3><i class="fas fa-check-circle"></i> Temas Concluídos</h3><div class="value" id="completed-count">0</div><div class="progress-bar"><div class="progress-fill" id="progress-fill"></div></div><small id="progress-percentage">0%</small></div>
                    <div class="stat-card"><h3><i class="fas fa-calendar-day"></i> Dias Restantes</h3><div class="value" id="days-left">0</div><small>até a data da prova</small></div>
                    <div class="stat-card"><h3><i class="fas fa-redo"></i> Revisões Pendentes</h3><div class="value" id="reviews-pending">0</div><small>temas para revisar</small></div>
                    <div class="stat-card"><h3><i class="fas fa-star"></i> Dificuldade Média</h3><div class="value" id="avg-difficulty">-</div><small>dos temas concluídos</small></div>
                </div>
                <div class="chart-container fade-in"><h3><i class="fas fa-tasks"></i> Conclusão por Matéria (%)</h3><canvas id="graficoPorMateria"></canvas></div>
                <div class="chart-container fade-in"><h3><i class="fas fa-chart-line"></i> Desempenho Médio por Área (%)</h3><canvas id="graficoDesempenhoPorArea"></canvas></div>
            </section>

            <section id="achievements-section" class="content-section"><h2 style="margin-bottom: 20px; color: var(--primary-color);"><i class="fas fa-trophy"></i> Suas Conquistas</h2><div class="achievements-grid" id="achievements-grid"></div></section>
            
            <section id="performance-section" class="content-section">
                <div class="controls-section fade-in"><h2><i class="fas fa-chart-line"></i> Registro de Desempenho</h2><p>Anote aqui seus resultados em simulados e listas de exercícios.</p>
                    <div class="config-form" style="align-items: flex-end;">
                        <div class="config-group"><label for="perf-date">Data:</label><input type="date" id="perf-date" class="config-input"></div>
                        <div class="config-group" style="flex-grow: 2;"><label for="perf-topic-select">Tema Relacionado:</label><select id="perf-topic-select" class="config-input"></select></div>
                        <div class="config-group"><label for="perf-questions-attempted">Questões:</label><input type="number" id="perf-questions-attempted" class="config-input" min="1" placeholder="Ex: 50"></div>
                        <div class="config-group"><label for="perf-questions-correct">Acertos:</label><input type="number" id="perf-questions-correct" class="config-input" min="0" placeholder="Ex: 42"></div>
                        <button class="btn" id="save-performance-entry" style="padding: 12px 20px;"><i class="fas fa-save"></i> Salvar</button>
                    </div>
        <div style="display: flex; align-items: center; gap: 15px; margin-top: 20px;">
            <a href="https://app.hardworq.com.br/signin" target="_blank" class="btn" style="background-color: #6a1b9a; padding: 12px 20px;">
                <i class="fas fa-database"></i> HardWorq
            </a>
            <span style="font-size: 0.9em; color: var(--text-color);">
                Utilize o banco de questões gratuitas do HardWorq
            </span>
        </div>
    </div>
                <div class="controls-section fade-in" style="margin-top: 20px;"><h3><i class="fas fa-history"></i> Histórico de Registros</h3><div id="performance-history-container" style="overflow-x: auto;"></div></div>
            </section>
            
            <section id="progress-section" class="content-section"><h2 style="margin-bottom: 20px; color: var(--primary-color);"><i class="fas fa-tasks"></i> Progresso por Matéria</h2><div id="progress-lists"></div></section>
            <section id="pomodoro-section" class="content-section"><div class="pomodoro-section fade-in"><h3><i class="fas fa-clock"></i> Timer Pomodoro</h3><div class="pomodoro-display" id="pomodoro-display">25:00</div><div class="pomodoro-controls"><button class="btn" id="pomodoro-start"><i class="fas fa-play"></i> Iniciar</button><button class="btn" id="pomodoro-pause"><i class="fas fa-pause"></i> Pausar</button><button class="btn" id="pomodoro-reset"><i class="fas fa-stop"></i> Resetar</button></div><div class="pomodoro-settings"><div><label>Foco (min):</label><input type="number" id="focus-time" value="25" min="1" max="60"></div><div><label>Pausa (min):</label><input type="number" id="break-time" value="5" min="1" max="30"></div></div></div></section>
            <section id="review-section" class="content-section"><div class="controls-section fade-in"><h3><i class="fas fa-brain"></i> Revisões Futuras</h3><div id="future-reviews-container"></div></div></section>
            <section id="settings-section" class="content-section"><div class="controls-section fade-in"><h3><i class="fas fa-cog"></i> Configurações</h3><div class="config-form"><div class="config-group"><label for="start-date">Data de Início:</label><input type="date" id="start-date" class="config-input"></div><div class="config-group"><label for="exam-date">Data da Prova:</label><input type="date" id="exam-date" class="config-input"></div><div class="config-group"><label for="max-topics-day">Máx. Temas/Dia:</label><input type="number" id="max-topics-day" class="config-input" value="5" min="1" max="10"></div></div><div style="margin-top: 30px; border-top: 2px solid var(--border-color); padding-top: 20px;"><h4><i class="fas fa-plus-circle"></i> Adicionar Temas Personalizados</h4><div class="config-form-group" style="margin-top: 15px;"><div class="config-group"><label for="custom-theme-name">Nome do Tema:</label><input type="text" id="custom-theme-name" class="config-input" placeholder="Ex: Revisão de ECG"></div><div class="config-group"><label for="custom-theme-area">Área:</label><select id="custom-theme-area" class="config-input"><option value="preventiva">Preventiva</option><option value="pediatria">Pediatria</option><option value="ginecologia">Ginecologia</option><option value="obstetricia">Obstetrícia</option><option value="clinica">Clínica</option><option value="cirurgia">Cirurgia</option><option value="psiquiatria">Psiquiatria</option><option value="revisao">Revisão</option></select></div><button class="btn" id="add-custom-theme-btn"><i class="fas fa-plus"></i> Add</button></div><div id="custom-themes-list" style="margin-top: 20px;"></div></div><button class="btn" id="apply-config" style="margin-top: 30px; background-color: var(--primary-color); padding: 15px 25px; font-size: 1.1em; width: 100%;"><i class="fas fa-save"></i> Salvar e Atualizar Cronograma</button></div></section>
            <section id="weeks-section" class="content-section"><div class="controls-section fade-in"><div class="controls-grid"><div><label for="search-box">🔍 Buscar tema:</label><input type="text" id="search-box" class="search-box" placeholder="Digite o nome do tema..."></div><div><label for="area-filter">🏥 Filtrar por área:</label><select id="area-filter" class="filter-select"><option value="all">Todas as áreas</option><option value="preventiva">Preventiva</option><option value="pediatria">Pediatria</option><option value="ginecologia">Ginecologia</option><option value="obstetricia">Obstetrícia</option><option value="clinica">Clínica</option><option value="cirurgia">Cirurgia</option><option value="psiquiatria">Psiquiatria</option><option value="revisao">Revisão</option></select></div></div></div><button class="btn expand-weeks-btn" id="expand-weeks" style="display: none;"><i class="fas fa-expand"></i> Mostrar todas as semanas</button><div id="weeks"></div></section>
        </main>

        <div class="medical-chatbot">
            <div class="chatbot-container" id="chatbot-container">
                <div class="chatbot-header">
                    <button class="chatbot-close" id="chatbot-close">×</button>
                    <h3>🧠 IA Médica Revalida</h3>
                    <p>Seu assistente de estudos especializado</p>
                </div>
                
                <div class="chat-messages" id="chat-messages">
                    <div class="message bot">
                        <div class="message-bubble">
                            👋 Olá! Sou sua IA especializada em Revalida/Enamed. Posso te ajudar com:
                            <br><br>
                            • Resumos técnicos de qualquer tema
                            • Explicações didáticas 
                            • Perguntas de fixação
                            • Dicas de estudo por área
                            <br><br>
                            Como posso te ajudar hoje?
                        </div>
                        <div class="message-time">Agora</div>
                    </div>
                    
                    <div class="quick-topics">
                        <div class="quick-topic" data-topic="Resumo de Hipertensão Arterial">Hipertensão</div>
                        <div class="quick-topic" data-topic="Diabetes Mellitus principais pontos">Diabetes</div>
                        <div class="quick-topic" data-topic="Infarto Agudo do Miocárdio tratamento">IAM</div>
                        <div class="quick-topic" data-topic="Pneumonia diagnóstico">Pneumonia</div>
                        <div class="quick-topic" data-topic="Anemia ferropriva pediatria">Anemia</div>
                    </div>
                </div>
                
                <div class="typing-indicator" id="typing-indicator">
                    <span>🧠 IA pensando</span>
                    <div class="typing-dots">
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                    </div>
                </div>
                
                <div class="chat-input-container">
                    <div class="chat-input-wrapper">
                        <textarea 
                            class="chat-input" 
                            id="chat-input" 
                            placeholder="Digite sua pergunta sobre medicina..."
                            rows="1"
                        ></textarea>
                        <button class="chat-send" id="chat-send">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
            </div>
            
            <button class="chatbot-toggle" id="chatbot-toggle">
                <i class="fas fa-brain"></i>
            </button>
        </div>

        <div class="modal" id="difficulty-modal"><div class="modal-content"><h3>Como foi estudar este tema?</h3><p>Avalie a dificuldade para melhorar suas revisões:</p><div class="difficulty-buttons"><button class="difficulty-btn difficulty-easy" data-difficulty="easy">😊 Fácil</button><button class="difficulty-btn difficulty-medium" data-difficulty="medium">😐 Médio</button><button class="difficulty-btn difficulty-hard" data-difficulty="hard">😰 Difícil</button></div></div></div>
        <div class="modal" id="confirmation-modal"><div class="modal-content"><h3>⚠️ Confirmar Reset</h3><p>Tem certeza que deseja resetar todo o progresso e configurações? Isso inclui suas conquistas!</p><p><strong>Esta ação não pode ser desfeita!</strong></p><div class="confirmation-buttons"><button class="btn btn-confirm" id="confirm-reset"><i class="fas fa-trash"></i> Sim, Resetar</button><button class="btn btn-cancel" id="cancel-reset"><i class="fas fa-times"></i> Cancelar</button></div></div></div>
        <div id="achievement-notification" class="achievement-notification"><i id="achievement-icon" class="fas fa-trophy"></i><div><h4 id="achievement-title">Conquista Desbloqueada!</h4><p id="achievement-desc">Descrição da conquista.</p></div></div>

   <div class="modal" id="ia-flashcard-modal">
  <div class="modal-content">
    <h3 id="ia-flashcard-title"></h3>
    <div id="ia-resumo"></div>
    <button class="btn btn-cancel" onclick="hideModal('ia-flashcard-modal')">Fechar</button>
  </div>
</div>
    </div>

    <script>
        // Configuração do Supabase
        const SUPABASE_URL = 'https://oczcyffaolkokunxgdzf.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9jemN5ZmZhb2xrb2t1bnhnZHpmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQxNzcwMDMsImV4cCI6MjA2OTc1MzAwM30.MUzZw2yJeuLqlmOoCPrTZEf1XjfNOK-JkF-Hz_EerEk';
        
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        
        let currentUser = null;
        let isSignUp = false;

        // =================================================================================
        // DADOS E ESTADO DA APLICAÇÃO (será preenchido pelos dados do Supabase)
        // =================================================================================
        const defaultState = {
            sidebarOpen: false,
            sidebarCollapsed: false,
            minimalistMode: false,
            darkMode: false,
            pomodoroRunning: false,
            pomodoroTime: 25 * 60,
            pomodoroInterval: null,
            currentPomodoroType: 'focus',
            currentDifficultyTopic: null,
            currentSection: 'stats',
            charts: {
                completionBySubject: null,
                performanceByArea: null
            },
            completedTopics: {},
            topicDifficulties: {},
            lastReviewDates: {},
            customThemes: [], 
            performanceLog: [],
            userProfile: {
                username: 'Convidado', // Adicionado
                xp: 0,
                level: 0,
                unlockedAchievements: {},
                lastStudyDate: null,
                studyStreak: 0,
                completedPomodoros: 0,
                totalStudyTimeSeconds: 0 // Adicionado
            },
            scheduleConfig: {
                startDate: '2025-07-28',
                examDate: '2025-10-19',
                maxTopicsPerDay: 4
            },
            allTopicsFlat: [],
            studyTimerInterval: null // Adicionado
        };
        
        let appState = { ...defaultState };

        const originalScheduleData = [// SEMANA 1 - INTRODUÇÃO ÀS ÁREAS
// SEGUNDA - CLÍNICA MÉDICA (Temas básicos)
{theme:"Hipertensão Arterial Sistêmica",area:"clinica"},
{theme:"Diabetes - diagnóstico e classificação",area:"clinica"},
{theme:"Cefaleia",area:"clinica"},
{theme:"Lombalgia",area:"clinica"},

// TERÇA - PEDIATRIA (Fundamentos)
{theme:"Puericultura",area:"pediatria"},
{theme:"Distúrbios do crescimento e desenvolvimento",area:"pediatria"},
{theme:"Avaliação neonatal",area:"pediatria"},
{theme:"Triagem neonatal",area:"pediatria"},

// QUARTA - GINECO-OBSTETRÍCIA (Base)
{theme:"Assistência pré-natal",area:"obstetricia"},
{theme:"Planejamento familiar",area:"ginecologia"},
{theme:"Amenorreia",area:"ginecologia"},
{theme:"Sangramento Uterino Anormal",area:"ginecologia"},

// QUINTA - CIRURGIA (Emergências)
{theme:"Abdome agudo - apendicite",area:"cirurgia"},
{theme:"Trauma - atendimento inicial e vias aéreas",area:"cirurgia"},
{theme:"Técnica cirúrgica e Corpo estranho",area:"cirurgia"},
{theme:"Hérnias",area:"cirurgia"},

// SEXTA - MEDICINA PREVENTIVA (SUS e Básico)
{theme:"SUS",area:"preventiva"},
{theme:"Atenção Básica",area:"preventiva"},
{theme:"Saúde da Família",area:"preventiva"},
{theme:"Indicadores de Saúde",area:"preventiva"},

// SEMANA 2 - APROFUNDAMENTO
// SEGUNDA - CLÍNICA MÉDICA (Cardio-Pneumo)
{theme:"Síndrome Coronariana Aguda",area:"clinica"},
{theme:"Insuficiência cardíaca",area:"clinica"},
{theme:"Arritmias",area:"clinica"},
{theme:"Pneumonia",area:"clinica"},
{theme:"Asma",area:"clinica"},

// TERÇA - PEDIATRIA (Respiratório e Infeccioso)
{theme:"Pneumonia na infância",area:"pediatria"},
{theme:"Bronquiolite",area:"pediatria"},
{theme:"IVAS",area:"pediatria"},
{theme:"Doenças Exantemáticas",area:"pediatria"},
{theme:"Desconforto respiratório do recém-nascido",area:"pediatria"},

// QUARTA - GINECO-OBSTETRÍCIA (Patologias Gestacionais)
{theme:"Síndromes hipertensivas da gestação",area:"obstetricia"},
{theme:"Diabetes na gestação",area:"obstetricia"},
{theme:"HIV e gestação",area:"obstetricia"},
{theme:"Infecção urinária na gestação",area:"obstetricia"},
{theme:"TORCH e Sífilis",area:"obstetricia"},

// QUINTA - CIRURGIA (Abdome Agudo)
{theme:"Abdome agudo - pancreatite aguda",area:"cirurgia"},
{theme:"Abdome agudo - diverticulite",area:"cirurgia"},
{theme:"Abdome agudo obstrutivo",area:"cirurgia"},
{theme:"Abdome agudo perfurativo, vascular e hemorrágico",area:"cirurgia"},

// SEXTA - MEDICINA PREVENTIVA (Vigilância)
{theme:"Vigilância Epidemiológica e Epidemias",area:"preventiva"},
{theme:"Dengue",area:"preventiva"},
{theme:"Chikungunya, Zika e Febre amarela",area:"preventiva"},
{theme:"Vacinas",area:"preventiva"},

// SEMANA 3 - ESPECIALIZAÇÃO
// SEGUNDA - CLÍNICA MÉDICA (Endócrino-Metabólico)
{theme:"Diabetes - tratamento",area:"clinica"},
{theme:"Diabetes - complicações",area:"clinica"},
{theme:"Hipotireoidismo",area:"clinica"},
{theme:"Hipertireoidismo",area:"clinica"},
{theme:"Dislipidemia",area:"clinica"},

// TERÇA - PEDIATRIA (Gastro-Urinário)
{theme:"Diarreia e desidratação",area:"pediatria"},
{theme:"Constipação na infância",area:"pediatria"},
{theme:"ITU na infância",area:"pediatria"},
{theme:"Icterícia neonatal",area:"pediatria"},
{theme:"Desnutrição e obesidade",area:"pediatria"},

// QUARTA - GINECO-OBSTETRÍCIA (Hemorragias)
{theme:"Hemorragias da primeira metade da gestação",area:"obstetricia"},
{theme:"Hemorragias da segunda metade da gestação",area:"obstetricia"},
{theme:"Hemorragia pós-parto e distocias",area:"obstetricia"},
{theme:"Rotura prematura de membranas",area:"obstetricia"},

// QUINTA - CIRURGIA (Trauma)
{theme:"Trauma - TCE e TRM",area:"cirurgia"},
{theme:"Trauma torácico",area:"cirurgia"},
{theme:"Trauma abdominal",area:"cirurgia"},
{theme:"Trauma cervical e pélvico",area:"cirurgia"},

// SEXTA - MEDICINA PREVENTIVA (Doenças Transmissíveis)
{theme:"Tuberculose",area:"preventiva"},
{theme:"Hanseníase",area:"preventiva"},
{theme:"HIV/AIDS",area:"preventiva"},
{theme:"Hepatites virais",area:"preventiva"},

// SEMANA 4 - CONSOLIDAÇÃO
// SEGUNDA - CLÍNICA MÉDICA (Neurológico)
{theme:"AVC",area:"clinica"},
{theme:"Epilepsia e convulsão febril",area:"clinica"},
{theme:"Doença de Parkinson",area:"clinica"},
{theme:"Meningite",area:"clinica"},

// TERÇA - PEDIATRIA (Especialidades)
{theme:"Cardiopatias congênitas",area:"pediatria"},
{theme:"Prematuridade",area:"pediatria"},
{theme:"Reanimação Neonatal",area:"pediatria"},
{theme:"Febre reumática",area:"pediatria"},

// QUARTA - GINECO-OBSTETRÍCIA (Parto e Puerpério)
{theme:"Mecanismo de parto e assistência clínica",area:"obstetricia"},
{theme:"Puerpério",area:"obstetricia"},
{theme:"Aleitamento materno",area:"obstetricia"},
{theme:"Vitalidade Fetal",area:"obstetricia"},

// QUINTA - CIRURGIA (Perioperatório)
{theme:"Perioperatório - exames, medicamentos, segurança",area:"cirurgia"},
{theme:"Perioperatório - antibiótico e infecção de sítio cirúrgico",area:"cirurgia"},
{theme:"Anestesia",area:"cirurgia"},
{theme:"Doação de órgãos e morte encefálica",area:"cirurgia"},

// SEXTA - MEDICINA PREVENTIVA (Ética e Legislação)
{theme:"Ética Médica - aspectos gerais",area:"preventiva"},
{theme:"Ética Médica - sigilo médico e informações médicas",area:"preventiva"},
{theme:"Declaração de óbito",area:"preventiva"},
{theme:"Medicina do Trabalho",area:"preventiva"},

// SEMANA 5 - REVISÃO E APROFUNDAMENTO
// SEGUNDA - CLÍNICA MÉDICA (Gastro-Hepato)
{theme:"Doença do refluxo gastroesofágico",area:"clinica"},
{theme:"Doença inflamatória intestinal",area:"clinica"},
{theme:"Síndrome do intestino irritável",area:"clinica"},
{theme:"Doenças das vias biliares",area:"clinica"},

// TERÇA - PEDIATRIA (Cirurgia Pediátrica)
{theme:"Cirurgia pediátrica - urologia e gastro",area:"pediatria"},
{theme:"Doenças congênitas",area:"pediatria"},
{theme:"Maus tratos",area:"pediatria"},

// QUARTA - GINECO-OBSTETRÍCIA (Oncologia)
{theme:"Câncer de colo de útero e HPV",area:"ginecologia"},
{theme:"Câncer de mama",area:"ginecologia"},
{theme:"Câncer de ovário",area:"ginecologia"},
{theme:"Doenças Benignas da Mama",area:"ginecologia"},

// QUINTA - CIRURGIA (Especialidades)
{theme:"Cirurgia vascular",area:"cirurgia"},
{theme:"Cirurgia plástica - queimados",area:"cirurgia"},
{theme:"Cirurgia plástica - câncer de pele melanoma e não melanoma",area:"cirurgia"},
{theme:"Urologia",area:"cirurgia"},

// SEXTA - MEDICINA PREVENTIVA (Parasitoses)
{theme:"Leishmaniose",area:"preventiva"},
{theme:"Leptospirose e malária",area:"preventiva"},
{theme:"Acidentes por animais peçonhentos",area:"preventiva"},
{theme:"Raiva e tétano",area:"preventiva"},

// SEMANA 6 - SISTEMAS ESPECÍFICOS
// SEGUNDA - CLÍNICA MÉDICA (Respiratório)
{theme:"DPOC",area:"clinica"},
{theme:"Crise de asma",area:"clinica"},
{theme:"O derrame pleural",area:"clinica"},
{theme:"Tromboembolia pulmonar",area:"clinica"},
{theme:"Câncer de pulmão",area:"clinica"},

// TERÇA - PEDIATRIA (Restante)
{theme:"Epilepsia e convulsão febril",area:"pediatria"},

// QUARTA - GINECO-OBSTETRÍCIA (Ginecologia Geral)
{theme:"Doença inflamatória pélvica - DIP",area:"ginecologia"},
{theme:"Endometriose",area:"ginecologia"},
{theme:"Síndrome dos ovários policísticos",area:"ginecologia"},
{theme:"Patologias vulvares",area:"ginecologia"},
{theme:"Conteúdo genital patológico",area:"ginecologia"},

// QUINTA - CIRURGIA (Oncologia)
{theme:"Câncer de esôfago",area:"cirurgia"},
{theme:"Tumores de pâncreas",area:"cirurgia"},
{theme:"Cirurgia da obesidade",area:"cirurgia"},

// SEXTA - MEDICINA PREVENTIVA (Complementar)
{theme:"Processo Saúde-Doença",area:"preventiva"},
{theme:"Testes diagnósticos e Estudos Epidemiológicos",area:"preventiva"},

// SEMANA 7 - SISTEMAS ESPECIAIS
// SEGUNDA - CLÍNICA MÉDICA (Hematologia)
{theme:"Anemia hipoproliferativas",area:"clinica"},
{theme:"Anemias hiperproliferativas",area:"clinica"},
{theme:"Neoplasias Hematológicas",area:"clinica"},
{theme:"Distúrbios da hemostasia",area:"clinica"},

// TERÇA - PEDIATRIA (Vazio - usar para revisão)

// QUARTA - GINECO-OBSTETRÍCIA (Especialidades)
{theme:"Infertilidade",area:"ginecologia"},
{theme:"Toxoplasmose e gestação",area:"obstetricia"},
{theme:"Isoimunização RH",area:"obstetricia"},
{theme:"Relações uterofetais",area:"obstetricia"},
{theme:"Restrição de Crescimento Fetal",area:"obstetricia"},

// QUINTA - CIRURGIA (Ortopedia)
{theme:"Ortopedia e Trauma de extremidades",area:"cirurgia"},

// SEXTA - MEDICINA PREVENTIVA (Especialidades)
{theme:"Violência sexual",area:"preventiva"},

// SEMANA 8 - COMPLEMENTARES
// SEGUNDA - CLÍNICA MÉDICA (Reumatologia)
{theme:"Artrite reumatoide",area:"clinica"},
{theme:"Lúpus",area:"clinica"},
{theme:"Monoartrite aguda - gota e artrite infecciosa",area:"clinica"},
{theme:"Fibromialgia",area:"clinica"},

// TERÇA - PEDIATRIA (Vazio - revisão)

// QUARTA - GINECO-OBSTETRÍCIA (Vazio - revisão)

// QUINTA - CIRURGIA (Especialidades)
{theme:"Otorrinolaringologia",area:"cirurgia"},
{theme:"Doenças orificiais",area:"cirurgia"},

// SEXTA - MEDICINA PREVENTIVA (Finais)
{theme:"Intoxicações exógenas",area:"preventiva"},
{theme:"Cuidados paliativos",area:"preventiva"},

// SEMANA 9 - COMPLEMENTARES
// SEGUNDA - CLÍNICA MÉDICA (Nefrologia/Urologia)
{theme:"Infecção do trato urinário",area:"clinica"},
{theme:"Doenças glomerulares",area:"clinica"},
{theme:"IRA",area:"clinica"},
{theme:"HTA secundária",area:"clinica"},

// TERÇA-SEXTA (Áreas restantes e revisão)
// SEGUNDA - CLÍNICA MÉDICA (Endócrino)
{theme:"Nódulo e Câncer de Tireoide",area:"clinica"},

// SEGUNDA - CLÍNICA MÉDICA (Cardiologia)
{theme:"Valvulopatia",area:"clinica"},

// SEGUNDA - CLÍNICA MÉDICA (Emergência)
{theme:"Sepse",area:"clinica"},
{theme:"PBLS e PALS",area:"clinica"},

// SEGUNDA - CLÍNICA MÉDICA (Psiquiatria)
{theme:"Psiquiatria geral",area:"clinica"},
{theme:"Transtornos do Humor",area:"clinica"},

// SEGUNDA - CLÍNICA MÉDICA (Geriatria)
{theme:"Geriatria",area:"clinica"},

// SEGUNDA - CLÍNICA MÉDICA (IST)
{theme:"IST - úlceras genitais",area:"clinica"}];

        // =================================================================================
        // LÓGICA DE AUTENTICAÇÃO E DADOS (CORRIGIDA E MELHORADA)
        // =================================================================================

        // Função para salvar todos os dados do estado da aplicação no Supabase
        async function saveAllData() {
            if (!currentUser) return;

            const dataToSave = {
                id: currentUser.id,
                user_id: currentUser.id,
                completed_topics: appState.completedTopics,
                topic_difficulties: appState.topicDifficulties,
                last_review_dates: appState.lastReviewDates,
                custom_themes: appState.customThemes,
                performance_log: appState.performanceLog,
                user_profile: appState.userProfile,
                schedule_config: appState.scheduleConfig,
                dark_mode: appState.darkMode,
                minimalist_mode: appState.minimalistMode
            };

            try {
                const { error } = await supabase
                    .from('user_data')
                    .upsert(dataToSave, { onConflict: 'id' }); // 'upsert' cria ou atualiza
                
                if (error) throw error;
            } catch (error) {
                console.error('Erro ao salvar dados no Supabase:', error);
            }
        }

        // Carregar dados do usuário do Supabase e popular o appState
        async function loadUserData() {
            if (!currentUser) return;

            try {
                const { data, error } = await supabase
                    .from('user_data')
                    .select('*')
                    .eq('id', currentUser.id)
                    .single();

                if (error && error.code !== 'PGRST116') { // PGRST116 = no rows found, o que é normal para um usuário novo
                    throw error;
                }

                if (data) {
                    // Preenche o appState com os dados da nuvem
                    appState.completedTopics = data.completed_topics || {};
                    appState.topicDifficulties = data.topic_difficulties || {};
                    appState.lastReviewDates = data.last_review_dates || {};
                    appState.customThemes = data.custom_themes || [];
                    appState.performanceLog = data.performance_log || [];
                    
                    // Mescla o perfil do usuário, garantindo que novos campos (como username) sejam adicionados
                    appState.userProfile = { ...defaultState.userProfile, ...data.user_profile };
                    // Se o username estiver nos metadados (auth) e não no perfil, atualize
                    if (currentUser.user_metadata?.username && !appState.userProfile.username) {
                        appState.userProfile.username = currentUser.user_metadata.username;
                    }

                    appState.scheduleConfig = data.schedule_config || defaultState.scheduleConfig;
                    appState.darkMode = data.dark_mode || false;
                    appState.minimalistMode = data.minimalist_mode || false;
                } else {
                    // Se não houver dados, é um usuário novo, então salvamos o estado inicial
                    // que já contém o username dos metadados (se fornecido no cadastro)
                    appState.userProfile.username = currentUser.user_metadata?.username || 'Novo Usuário';
                    await saveAllData();
                }
            } catch (error) {
                console.error('Erro ao carregar dados do Supabase:', error);
                alert('Não foi possível carregar seus dados. Tente recarregar a página.');
            }
        }
        
        // Mostrar tela de autenticação
        function showAuth() {
            document.getElementById('auth-container').style.display = 'flex';
            document.getElementById('app-container').style.display = 'none';
        }

        // Mostrar aplicação principal
        function showApp() {
            document.getElementById('auth-container').style.display = 'none';
            document.getElementById('app-container').style.display = 'block';
        }
        
        // Verificar se o usuário está logado ao carregar a página
        async function checkAuth() {
            const { data: { session } } = await supabase.auth.getSession();
            if (session?.user) {
                currentUser = session.user;
                showApp();
                await loadUserData();
                initializeApp(); // **CHAMADA CRÍTICA #1**
            } else {
                showAuth();
            }
        }

        // Alternar entre login e cadastro
        function toggleAuthMode(toSignUp) {
            isSignUp = toSignUp;
            const usernameGroup = document.getElementById('username-group');
            
            document.getElementById('login-toggle').classList.toggle('active', !isSignUp);
            document.getElementById('login-toggle').classList.toggle('inactive', isSignUp);
            document.getElementById('signup-toggle').classList.toggle('active', isSignUp);
            document.getElementById('signup-toggle').classList.toggle('inactive', !isSignUp);

            if(isSignUp) {
                usernameGroup.style.display = 'block';
                document.getElementById('auth-title').textContent = 'Crie sua Conta';
                document.getElementById('form-subtitle').textContent = 'Comece sua jornada para a aprovação';
                document.getElementById('submit-text').textContent = 'Cadastrar';
                document.getElementById('submit-icon').className = 'fas fa-user-plus';
                document.getElementById('footer-text').textContent = 'Já tem uma conta?';
                document.getElementById('switch-to-signup').textContent = 'Faça login';
                document.getElementById('switch-to-signup').onclick = () => toggleAuthMode(false);
            } else {
                usernameGroup.style.display = 'none';
                document.getElementById('auth-title').textContent = 'Bem-vindo de volta!';
                document.getElementById('form-subtitle').textContent = 'Continue seus estudos de onde parou';
                document.getElementById('submit-text').textContent = 'Entrar';
                document.getElementById('submit-icon').className = 'fas fa-sign-in-alt';
                document.getElementById('footer-text').textContent = 'Não tem uma conta?';
                document.getElementById('switch-to-signup').textContent = 'Cadastre-se';
                document.getElementById('switch-to-signup').onclick = () => toggleAuthMode(true);
            }
        }


        // Fazer login ou cadastro
        async function handleAuth() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const username = document.getElementById('username').value;
            
            if (!email || !password || (isSignUp && !username)) {
                alert('Preencha todos os campos obrigatórios.');
                return;
            }

            try {
                let authResponse;
                if (isSignUp) {
                    authResponse = await supabase.auth.signUp({ 
                        email, 
                        password,
                        options: {
                            data: {
                                username: username // Adiciona o username aos metadados
                            }
                        }
                    });
                    if(authResponse.error) throw authResponse.error;
                    alert('Cadastro realizado! Verifique seu e-mail para confirmar a conta e depois faça o login.');
                    toggleAuthMode(false); // Volta para a tela de login
                } else {
                    authResponse = await supabase.auth.signInWithPassword({ email, password });
                    if(authResponse.error) throw authResponse.error;
                    
                    currentUser = authResponse.data.user;
                    showApp();
                    await loadUserData();
                    initializeApp(); // **CHAMADA CRÍTICA #2**
                }
            } catch (error) {
                alert('Erro: ' + error.message);
            }
        }

        // Fazer logout
        async function handleLogout() {
            await supabase.auth.signOut();
            currentUser = null;
            // Limpa o estado para não vazar dados para o próximo usuário
            appState = { ...defaultState }; 
            // Recarrega a página para garantir um estado limpo
            window.location.reload(); 
        }

        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('login-toggle').onclick = () => toggleAuthMode(false);
            document.getElementById('signup-toggle').onclick = () => toggleAuthMode(true);
            
            document.getElementById('auth-button').addEventListener('click', handleAuth);
            document.getElementById('switch-to-signup').onclick = () => toggleAuthMode(true);
            
            document.getElementById('email').addEventListener('keypress', (e) => e.key === 'Enter' && handleAuth());
            document.getElementById('password').addEventListener('keypress', (e) => e.key === 'Enter' && handleAuth());
            document.getElementById('username').addEventListener('keypress', (e) => e.key === 'Enter' && handleAuth());


            checkAuth();
        });


        // =================================================================================
        // SCRIPT COMPLETO DO CRONOGRAMA (PRESERVADO E FUNCIONAL)
        // =================================================================================

        const motivationalQuotes = ["Cada página estudada é um passo mais perto do seu sonho de médico! 💉", "Você é mais forte do que qualquer desafio do Revalida! 🚀", "Foco e determinação: você vai conquistar o Enamed! 🩺", "A jornada é longa, mas sua dedicação é imbatível! 🌟", "Estude com paixão, você está moldando o futuro da saúde! ❤️"];

        // CONFIGURAÇÃO DO CHATBOT MÉDICO
        // ---------------------------------------------------------------------------------
        const GEMINI_API_KEY = 'AIzaSyBtGkKLxXBnr2ro-qGR3J2-feq5W4HKKwk';
        const GEMINI_API_URL = 'https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent';

        const medicalChatbot = {
            isOpen: false,
            conversationHistory: [],
            
            systemPrompt: `Você é um mentor médico especializado no Revalida 2025, com expertise comprovada na aprovação de candidatos. Atua como um residente R3 experiente que domina completamente os padrões da banca INEP/ENARE.

## PERFIL E COMPETÊNCIAS:
- Conhece profundamente os 150 temas mais cobrados no Revalida
- Domina a distribuição de frequência: Clínica Médica (30%), Pediatria (20%), GO (18%), Cirurgia (15%), Preventiva (17%)
- Especialista em questões objetivas e casos clínicos práticos
- Foca em condutas baseadas em protocolos brasileiros (MS, SBP, FEBRASGO, SBC)

## METODOLOGIA DE RESPOSTA:
**SEMPRE responda seguindo esta estrutura:**
1. **CONCEITO-CHAVE** (1-2 frases diretas)
2. **DIAGNÓSTICO/CONDUTA** (algoritmo prático)
3. **PONTO FREQUENTE NA PROVA** (o que a banca mais cobra)
4. **DICA DE MEMORIZAÇÃO** (mnemônico ou associação)

## ESPECIALIDADES E CONTEXTO:
- **Clínica Médica (CM):** HAS, DM, SCA, AVC, pneumonia, DPOC, cefaleia
- **Cirurgia (CR):** Abdome agudo, trauma, perioperatório, hérnias
- **Pediatria (PED):** Puericultura, pneumonia infantil, diarreia, crescimento
- **Gineco-Obstetrícia (GO):** Pré-natal, síndromes hipertensivas, hemorragias, parto
- **Medicina Preventiva (PRE):** SUS, atenção básica, vigilância, dengue, vacinas

## PADRÕES DE LINGUAGEM:
- Use linguagem médica precisa, mas acessível
- Seja DIRETO e OBJETIVO - sem rodeios
- Priorize CONDUTAS PRÁTICAS sobre fisiopatologia
- Mencione VALORES DE REFERÊNCIA quando relevante
- Cite PROTOCOLOS BRASILEIROS oficiais

## TIPOS DE INTERAÇÃO:
**Para dúvidas conceituais:** Explique com foco na prova
**Para casos clínicos:** Dê a conduta step-by-step
**Para revisão:** Faça resumos esquemáticos
**Para questões:** Explique o raciocínio da resposta correta

## ALERTAS IMPORTANTES:
- Se a pergunta for vaga, pergunte: "Qual tema específico ou cenário clínico?"
- Sempre contextualize para o cenário brasileiro (SUS, protocolos nacionais)
- Foque no que a banca REALMENTE cobra, não em curiosidades
- Termine sempre com: "Precisa de algum ponto específico deste tema?"

## OBJETIVO FINAL:
Seu único foco é APROVAR o usuário no Revalida 2025. Cada resposta deve ser um tijolo na construção dessa aprovação. Pense sempre: "Isso vai ajudar na prova?" Se não, seja mais direto.

Você está integrado ao sistema de estudos cronogramados por áreas semanais. Reconheça o contexto do cronograma e adapte suas respostas ao momento de estudo do usuário.`,

            async sendMessage(userMessage) {
                try {
                    const response = await fetch(GEMINI_API_URL, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-goog-api-key': GEMINI_API_KEY
                        },
                        body: JSON.stringify({
                            contents: [
                                {
                                    parts: [
                                        {
                                            text: this.systemPrompt + "\n\nPergunta do usuário: " + userMessage
                                        }
                                    ]
                                }
                            ],
                            generationConfig: {
                                temperature: 0.7,
                                maxOutputTokens: 800,
                            }
                        })
                    });

                    if (!response.ok) {
                        throw new Error(`Erro na API: ${response.status}`);
                    }

                    const data = await response.json();
                    const aiResponse = data?.candidates?.[0]?.content?.parts?.[0]?.text || 
                                      "Desculpe, não consegui processar sua pergunta. Tente novamente.";
                    
                    return aiResponse;
                } catch (error) {
                    console.error('Erro na chamada da API Gemini:', error);
                    return "Erro de conexão com a IA. Verifique sua internet e tente novamente.";
                }
            },

            addMessage(message, isUser = false) {
                const messageObj = {
                    text: message,
                    isUser: isUser,
                    timestamp: new Date().toLocaleTimeString('pt-BR', { 
                        hour: '2-digit', 
                        minute: '2-digit' 
                    })
                };
                
                this.conversationHistory.push(messageObj);
                this.renderMessage(messageObj);
            },

            renderMessage(messageObj) {
                const messagesContainer = document.getElementById('chat-messages');
                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${messageObj.isUser ? 'user' : 'bot'}`;
                
                messageDiv.innerHTML = `
                    <div class="message-bubble">
                        ${messageObj.text.replace(/\n/g, '<br>')}
                    </div>
                    <div class="message-time">${messageObj.timestamp}</div>
                `;
                
                if (messageObj.isUser && this.conversationHistory.filter(m => m.isUser).length === 1) {
                    const quickTopics = messagesContainer.querySelector('.quick-topics');
                    if (quickTopics) quickTopics.remove();
                }
                
                messagesContainer.appendChild(messageDiv);
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            },

            showTyping() {
                document.getElementById('typing-indicator').classList.add('active');
                const messagesContainer = document.getElementById('chat-messages');
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            },

            hideTyping() {
                document.getElementById('typing-indicator').classList.remove('active');
            },

            async handleUserMessage(message) {
                if (!message.trim()) return;
                
                this.addMessage(message, true);
                this.showTyping();
                
                const aiResponse = await this.sendMessage(message);
                
                this.hideTyping();
                this.addMessage(aiResponse, false);
                
                document.getElementById('chat-input').value = '';
                this.adjustTextareaHeight();
            },

            adjustTextareaHeight() {
                const textarea = document.getElementById('chat-input');
                textarea.style.height = 'auto';
                textarea.style.height = Math.min(textarea.scrollHeight, 100) + 'px';
            },

            toggle() {
                this.isOpen = !this.isOpen;
                document.getElementById('chatbot-container').classList.toggle('active', this.isOpen);
                document.getElementById('chatbot-toggle').classList.toggle('active', this.isOpen);
                
                if (this.isOpen) {
                    document.getElementById('chat-input').focus();
                    this.loadHistory();
                }
            },

            loadHistory() {
                const messagesContainer = document.getElementById('chat-messages');
                const firstMessage = messagesContainer.querySelector('.message.bot');
                const quickTopics = messagesContainer.querySelector('.quick-topics');
                messagesContainer.innerHTML = '';
                
                if (firstMessage) messagesContainer.appendChild(firstMessage);
                if (quickTopics && this.conversationHistory.filter(m => m.isUser).length === 0) {
                    messagesContainer.appendChild(quickTopics);
                }
                
                this.conversationHistory.forEach(msg => this.renderMessage(msg));
            },

            init() {
                const toggle = document.getElementById('chatbot-toggle');
                const close = document.getElementById('chatbot-close');
                const sendBtn = document.getElementById('chat-send');
                const input = document.getElementById('chat-input');
                
                toggle.addEventListener('click', () => this.toggle());
                close.addEventListener('click', () => this.toggle());
                
                sendBtn.addEventListener('click', () => {
                    const message = input.value.trim();
                    if (message) this.handleUserMessage(message);
                });
                
                input.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        const message = input.value.trim();
                        if (message) this.handleUserMessage(message);
                    }
                });
                
                input.addEventListener('input', () => this.adjustTextareaHeight());
                
                document.querySelectorAll('.quick-topic').forEach(topic => {
                    topic.addEventListener('click', () => this.handleUserMessage(topic.dataset.topic));
                });
                
                document.addEventListener('click', (e) => {
                    if (this.isOpen && !e.target.closest('.medical-chatbot')) this.toggle();
                });
            }
        };

        // GAMIFICAÇÃO: NÍVEIS E CONQUISTAS
        // ---------------------------------------------------------------------------------
        const studentLevels = [
            { title: "Estudante Iniciante", avatar: "👶", xpRequired: 0 },
            { title: "Interno Virtual", avatar: "👨‍⚕️", xpRequired: 100 },
            { title: "R1 Clínico", avatar: "👩‍⚕️", xpRequired: 200 },
            { title: "R2 Cirúrgico", avatar: "🧑‍⚕️", xpRequired: 350 },
            { title: "R3 Especialista", avatar: "👨‍🔬", xpRequired: 550 },
            { title: "Especialista Júnior", avatar: "👩‍🔬", xpRequired: 800 },
            { title: "Especialista Pleno", avatar: "👨‍🎓", xpRequired: 1100 },
            { title: "Mestre em Medicina", avatar: "👩‍🎓", xpRequired: 1500 },
            { title: "Professor Doutor", avatar: "👨‍🏫", xpRequired: 2000 },
            { title: "Chefe de Serviço", avatar: "👩‍🏫", xpRequired: 2600 },
            { title: "Lenda Médica", avatar: "🦸", xpRequired: 3300 }
        ];
        const XP_VALUES = {
            completeTopic: 15,
            dailyStreak: 5,
            pomodoroComplete: 3,
            performanceEntry: 20,
            achievementUnlocked: 50
        };

        const achievements = {
            clinicoRaiz: { title: "Clínico Raiz", description: "Finalizou todos os temas de Clínica Médica.", icon: "fas fa-stethoscope", category: "area", check: (s) => checkAreaCompletion(s, 'clinica') },
            goWarrior: { title: "GO Warrior", description: "Finalizou Ginecologia e Obstetrícia.", icon: "fas fa-baby-carriage", category: "area", check: (s) => checkAreaCompletion(s, 'ginecologia') && checkAreaCompletion(s, 'obstetricia') },
            miniCirurgiao: { title: "Mini-Cirurgião", description: "Completou os temas de Cirurgia Geral.", icon: "fas fa-scalpel", category: "area", check: (s) => checkAreaCompletion(s, 'cirurgia') },
            pediatraMirim: { title: "Pediatra Mirim", description: "Concluiu todos os temas de Pediatria.", icon: "fas fa-child", category: "area", check: (s) => checkAreaCompletion(s, 'pediatria') },
            mestrePreventiva: { title: "Mestre da Preventiva", description: "Terminou os temas de Saúde Coletiva.", icon: "fas fa-users", category: "area", check: (s) => checkAreaCompletion(s, 'preventiva') },
            psiquiatraHonorario: { title: "Psiquiatra Honorário", description: "Finalizou os temas de Psiquiatria.", icon: "fas fa-brain", category: "area", check: (s) => checkAreaCompletion(s, 'psiquiatria') },
            
            leaoSimulado: { title: "Leão de Simulado", description: "Fez 5 registros de simulado/questões.", icon: "fas fa-award", category: "produtividade", check: (s) => s.performanceLog.length >= 5 },
            focoTotal: { title: "Foco Total", description: "Usou o Pomodoro por 10 ciclos completos.", icon: "fas fa-clock", category: "produtividade", check: (s) => s.userProfile.completedPomodoros >= 10 },
            modoTurbo: { title: "Modo Turbo", description: "Estudou todos os dias úteis da semana.", icon: "fas fa-bolt", category: "produtividade", check: () => checkWeekdayStreak() },
            chatbotExplorer: { title: "Explorador IA", description: "Fez 10 perguntas para a IA médica.", icon: "fas fa-robot", category: "produtividade", check: () => medicalChatbot.conversationHistory.filter(m => m.isUser).length >= 10 },

            streak1: { title: "Primeiro Passo", description: "1º dia consecutivo de estudo.", icon: "fas fa-shoe-prints", category: "consistencia", check: (s) => s.userProfile.studyStreak >= 1 },
            streak5: { title: "5 Dias no Ritmo", description: "Cinco dias seguidos estudando.", icon: "fas fa-fire", category: "consistencia", check: (s) => s.userProfile.studyStreak >= 5 },
            streak14: { title: "Study Beast", description: "14 dias seguidos sem falhar.", icon: "fas fa-meteor", category: "consistencia", check: (s) => s.userProfile.studyStreak >= 14 },
            streak30: { title: "Insano do Revalida", description: "30 dias de estudo consecutivos.", icon: "fas fa-crown", category: "consistencia", check: (s) => s.userProfile.studyStreak >= 30 },
            
            semanaPerfeita: { title: "Semana Perfeita", description: "Cumpriu 100% da meta da semana atual.", icon: "fas fa-check-double", category: "metas", check: () => checkCurrentWeekCompletion() },
            
            comecouNaSegunda: { title: "Começou na Segunda", description: "Iniciou a jornada numa segunda-feira.", icon: "fas fa-calendar-day", category: "secretas", check: (s) => new Date(s.scheduleConfig.startDate + "T12:00:00Z").getUTCDay() === 1 },
            vaiComTudo: { title: "Vai com Tudo!", description: "Estudou e fez simulado no mesmo dia.", icon: "fas fa-bomb", category: "secretas", check: (s) => checkStudyAndSimuladoToday(s) }
        };

        // FUNÇÕES DE LÓGICA DO CRONOGRAMA
        // ---------------------------------------------------------------------------------
        function prepareAllTopics() { appState.allTopicsFlat = [...originalScheduleData, ...appState.customThemes]; }
        function regenerateAndRenderSchedule() { prepareAllTopics(); const studyDays = getStudyDays(appState.scheduleConfig.startDate, appState.scheduleConfig.examDate); const distributionResult = distributeTopics(appState.allTopicsFlat, studyDays, appState.scheduleConfig.maxTopicsPerDay); const newSchedule = buildNewSchedule(distributionResult.distributedDays); generateDynamicWeeks(newSchedule); updateAllStatsAndCharts(); }
        function getStudyDays(startDateStr, endDateStr) { const studyDays = []; let currentDate = new Date(`${startDateStr}T12:00:00Z`); const endDate = new Date(`${endDateStr}T12:00:00Z`); while (currentDate <= endDate) { if (currentDate.getUTCDay() !== 0) { studyDays.push(new Date(currentDate)); } currentDate.setUTCDate(currentDate.getUTCDate() + 1); } return studyDays; }
        function distributeTopics(topics, studyDays, maxTopicsPerDay) { let topicIndex = 0; const distributedDays = []; for (let dayIndex = 0; dayIndex < studyDays.length; dayIndex++) { const weekIndex = Math.floor(dayIndex / 6); const topicsForThisDay = Math.min(weekIndex + 1, maxTopicsPerDay); const assignedTopics = []; if (topicIndex < topics.length) { for (let i = 0; i < topicsForThisDay && topicIndex < topics.length; i++) { assignedTopics.push(topics[topicIndex]); topicIndex++; } } distributedDays.push({ date: studyDays[dayIndex], topics: assignedTopics }); } const finalDays = distributedDays.filter(d => d.topics.length > 0); return { distributedDays: finalDays }; }
        function buildNewSchedule(distributedDays) { if (!distributedDays || distributedDays.length === 0) return []; const newSchedule = []; let weekChunk = []; distributedDays.sort((a, b) => a.date - b.date); for (const day of distributedDays) { if (weekChunk.length > 0 && day.date.getUTCDay() === 1) { newSchedule.push(weekChunk); weekChunk = []; } weekChunk.push(day); } if (weekChunk.length > 0) newSchedule.push(weekChunk); return newSchedule.map((weekDays, index) => { const dayMap = new Map(weekDays.map(d => [d.date.getUTCDay(), d])); let firstDayOfWeek = new Date(weekDays[0].date); let dayOfWeek = firstDayOfWeek.getUTCDay(); if (dayOfWeek === 0) dayOfWeek = 7; firstDayOfWeek.setUTCDate(firstDayOfWeek.getUTCDate() - (dayOfWeek - 1)); const fullWeekDays = []; for (let i = 1; i <= 7; i++) { const currentDay = new Date(firstDayOfWeek); currentDay.setUTCDate(firstDayOfWeek.getUTCDate() + i - 1); const dayData = dayMap.get(currentDay.getUTCDay()); if (currentDay.getUTCDay() === 0) { fullWeekDays.push({ date: currentDay, themes: [{ theme: 'DESCANSO', area: 'rest' }], isRest: true }); } else { fullWeekDays.push({ date: currentDay, themes: dayData ? dayData.topics : [], isRest: false }); } } const weekStartDate = fullWeekDays[0].date; const weekEndDate = fullWeekDays[5].date; return { week: index + 1, title: `Semana ${index + 1}: ${formatDate(weekStartDate)} - ${formatDate(weekEndDate)}`, days: fullWeekDays }; }); }

        // GAMIFICAÇÃO: LÓGICA E CHECAGEM
        // ---------------------------------------------------------------------------------
        function addXp(points, source = 'generic') {
            const oldLevel = getUserLevel();
            appState.userProfile.xp += points;
            const newLevel = getUserLevel();
            if (newLevel > oldLevel) {
                appState.userProfile.level = newLevel;
                showLevelUpNotification(newLevel);
                addXp(newLevel * 10, 'level-up');
            }
            updateHeaderUI();
            saveAllData(); // Salva o progresso
        }
        function getUserLevel() { for (let i = studentLevels.length - 1; i >= 0; i--) { if (appState.userProfile.xp >= studentLevels[i].xpRequired) return i; } return 0; }
        function showLevelUpNotification(newLevel) { const levelData = studentLevels[newLevel]; const notification = document.createElement('div'); notification.className = 'level-up-notification'; notification.innerHTML = `<div class="level-up-content"><div class="level-avatar">${levelData.avatar}</div><h3>🎉 Level Up!</h3><h4>${levelData.title}</h4><p>${appState.userProfile.username}, você alcançou um novo patamar!</p><small>Próximo nível em ${studentLevels[newLevel+1]?.xpRequired - appState.userProfile.xp || '---'} XP</small></div>`; document.body.appendChild(notification); setTimeout(() => { notification.classList.add('show'); setTimeout(() => { notification.classList.remove('show'); setTimeout(() => notification.remove(), 500); }, 3000); }, 100); }
        function updateHeaderUI() {
            const currentLevel = getUserLevel();
            const levelData = studentLevels[currentLevel];
            const nextLevel = currentLevel < studentLevels.length - 1 ? studentLevels[currentLevel + 1] : null;
            const progressPercentage = nextLevel ? Math.round(((appState.userProfile.xp - levelData.xpRequired) / (nextLevel.xpRequired - levelData.xpRequired)) * 100) : 100;

            const userLevelHTML = `
                <div class="level-container">
                    <div class="level-avatar">${levelData.avatar}</div>
                    <div>
                        <div>${levelData.title} <span class="level-badge">Nível ${currentLevel}</span></div>
                        <div class="level-info">${appState.userProfile.username || 'Usuário'}</div>
                    </div>
                </div>
            `;
            document.getElementById('user-level').innerHTML = userLevelHTML;
            document.getElementById('xp-bar-fill').style.width = `${progressPercentage}%`;
            document.getElementById('xp-bar-fill').parentElement.title = `${appState.userProfile.xp} XP (${progressPercentage}% para o próximo nível)`;
            document.getElementById('streak-count').textContent = appState.userProfile.studyStreak;
        }
        function unlockAchievement(key) { if (!appState.userProfile.unlockedAchievements[key]) { addXp(XP_VALUES.achievementUnlocked, 'achievement'); appState.userProfile.unlockedAchievements[key] = new Date().toISOString(); showAchievementNotification(achievements[key]); if (appState.currentSection === 'achievements') renderAchievementsPage(); } }
        function checkAllAchievements(eventData = null) { for (const key in achievements) { if (!appState.userProfile.unlockedAchievements[key]) { if (achievements[key].check(appState, eventData)) unlockAchievement(key); } } saveAllData(); }
        function renderAchievementsPage() { const container = document.getElementById('achievements-grid'); if (!container) return; const categories = { area: [], produtividade: [], consistencia: [], metas: [], revisao: [], secretas: [] }; for (const key in achievements) categories[achievements[key].category].push({ key, ...achievements[key] }); container.innerHTML = Object.keys(categories).map(catKey => { if (categories[catKey].length === 0) return ''; const categoryName = catKey.charAt(0).toUpperCase() + catKey.slice(1); const itemsHtml = categories[catKey].map(item => { const unlocked = appState.userProfile.unlockedAchievements[item.key]; const unlockedDate = unlocked ? `Desbloqueado em: ${new Date(unlocked).toLocaleDateString('pt-BR')}` : ''; return `<div class="achievement-item ${unlocked ? 'unlocked' : ''}" title="${item.description}"><i class="achievement-icon ${item.icon}"></i><div class="achievement-details"><h4>${item.title}</h4><p>${item.description}</p><p class="unlock-date">${unlockedDate}</p></div></div>`; }).join(''); return `<div class="achievement-category"><h3>${categoryName}</h3>${itemsHtml}</div>`; }).join(''); }
        function checkAreaCompletion(state, area) { const topicsOfArea = state.allTopicsFlat.filter(t => t.area === area); if (topicsOfArea.length === 0) return false; return topicsOfArea.every(t => state.completedTopics[t.theme]); }
        function checkWeekdayStreak() { const today = new Date(); if (today.getDay() === 0 || today.getDay() === 6) return false; const weekStart = new Date(today); weekStart.setDate(today.getDate() - today.getDay() + 1); let studiedDays = new Set(); Object.values(appState.lastReviewDates).forEach(d => { const studyDate = new Date(d); if (studyDate >= weekStart && studyDate <= today) studiedDays.add(studyDate.getDay()); }); return studiedDays.size >= today.getDay(); }
        function checkCurrentWeekCompletion() { const today = new Date(); const weekNum = Math.floor((today - new Date(appState.scheduleConfig.startDate)) / (1000 * 60 * 60 * 24 * 7)) + 1; const schedule = buildNewSchedule(distributeTopics(appState.allTopicsFlat, getStudyDays(appState.scheduleConfig.startDate, appState.scheduleConfig.examDate), appState.scheduleConfig.maxTopicsPerDay).distributedDays); const weekData = schedule.find(w => w.week === weekNum); if (!weekData) return false; return weekData.days.every(d => { if (d.isRest) return true; return d.themes.every(t => appState.completedTopics[t.theme]); }); }
        function checkStudyAndSimuladoToday(state) { const todayStr = new Date().toISOString().split('T')[0]; const studiedToday = Object.values(state.lastReviewDates).some(d => d.startsWith(todayStr)); const simuladoToday = state.performanceLog.some(p => p.date === todayStr); return studiedToday && simuladoToday; }
        
        // UI GERAL E INTERAÇÕES
        // ---------------------------------------------------------------------------------
        function toggleSidebar() { appState.sidebarOpen = !appState.sidebarOpen; appState.sidebarCollapsed = false; document.getElementById('sidebar').classList.toggle('open'); document.getElementById('main-content').classList.toggle('sidebar-open'); document.getElementById('header').classList.toggle('sidebar-open'); }
        function toggleTheme() { appState.darkMode = !appState.darkMode; document.documentElement.setAttribute('data-theme', appState.darkMode ? 'dark' : ''); saveAllData(); document.querySelector('#theme-toggle i').className = appState.darkMode ? 'fas fa-sun' : 'fas fa-moon'; updateAllStatsAndCharts(); }
        function toggleMinimalistMode() { appState.minimalistMode = !appState.minimalistMode; document.body.classList.toggle('minimalist-mode', appState.minimalistMode); saveAllData(); document.querySelector('#minimalist-toggle i').className = appState.minimalistMode ? 'fas fa-expand' : 'fas fa-compress'; }
        function showModal(modalId) { document.getElementById(modalId).classList.add('active'); }
        function hideModal(modalId) { document.getElementById(modalId).classList.remove('active'); }
        function showSection(sectionId) { document.querySelectorAll('.content-section').forEach(section => section.classList.remove('active')); const section = document.getElementById(`${sectionId}-section`); if (section) { section.classList.add('active'); appState.currentSection = sectionId; if (sectionId === 'stats') updateAllStatsAndCharts(); else if (sectionId === 'achievements') renderAchievementsPage(); else if (sectionId === 'performance') { populatePerformanceTopicSelect(); renderPerformanceHistory(); } else if (sectionId === 'progress') updateProgressLists(); else if (sectionId === 'review') updateFutureReviews(); } window.scrollTo(0, 0); }
        function updateAllStatsAndCharts() { updateStats(); updateStatusIcons(); if (appState.currentSection === 'stats') { createCompletionChart(); createPerformanceByAreaChart(); } }
        function showAchievementNotification(achievement) { const n = document.getElementById('achievement-notification'); n.querySelector('#achievement-icon').className = achievement.icon; n.querySelector('#achievement-title').textContent = achievement.title; n.querySelector('#achievement-desc').textContent = achievement.description; n.classList.add('show'); setTimeout(() => n.classList.remove('show'), 4000); }
        function updateStudyStreak() { const today = new Date().toDateString(); const lastStudyDate = appState.userProfile.lastStudyDate; if (lastStudyDate !== today) { const yesterday = new Date(); yesterday.setDate(yesterday.getDate() - 1); if (lastStudyDate === yesterday.toDateString()) { appState.userProfile.studyStreak++; } else { appState.userProfile.studyStreak = 1; } appState.userProfile.lastStudyDate = today; addXp(XP_VALUES.dailyStreak, 'streak'); } }

        // INICIALIZAÇÃO DA APLICAÇÃO (A SER CHAMADA APÓS LOGIN)
        // ---------------------------------------------------------------------------------
        function initializeApp() {
            if (appState.darkMode) { document.documentElement.setAttribute('data-theme', 'dark'); document.querySelector('#theme-toggle i').className = 'fas fa-sun'; }
            if(appState.minimalistMode) { document.body.classList.add('minimalist-mode'); document.querySelector('#minimalist-toggle i').className = 'fas fa-expand'; }
            
            document.getElementById('start-date').value = appState.scheduleConfig.startDate;
            document.getElementById('exam-date').value = appState.scheduleConfig.examDate;
            document.getElementById('max-topics-day').value = appState.scheduleConfig.maxTopicsPerDay;
            document.getElementById('perf-date').value = new Date().toISOString().split('T')[0];

            initializeEventListeners();
            prepareAllTopics();
            regenerateAndRenderSchedule();
            resetPomodoro();
            startPersistentStudyTimer(); // Alterado
            medicalChatbot.init();
            updateHeaderUI();
            checkAllAchievements({ type: 'load' });
            renderAchievementsPage();
            showSection('stats');
        }

        function initializeEventListeners() {
            document.getElementById('menu-toggle').addEventListener('click', toggleSidebar);
            document.getElementById('theme-toggle').addEventListener('click', toggleTheme);
            document.getElementById('minimalist-toggle').addEventListener('click', toggleMinimalistMode);
            document.getElementById('logout-btn').addEventListener('click', handleLogout);
            document.getElementById('pomodoro-start').addEventListener('click', startPomodoro);
            document.getElementById('pomodoro-pause').addEventListener('click', pausePomodoro);
            document.getElementById('pomodoro-reset').addEventListener('click', resetPomodoro);
            document.querySelectorAll('.sidebar-menu a[data-section]').forEach(link => { link.addEventListener('click', (e) => { e.preventDefault(); showSection(link.dataset.section); }); });
            document.getElementById('reset-progress').addEventListener('click', () => showModal('confirmation-modal'));
            document.getElementById('confirm-reset').addEventListener('click', async () => { if (currentUser) { await supabase.from('user_data').delete().eq('id', currentUser.id); } handleLogout(); });
            document.getElementById('cancel-reset').addEventListener('click', () => hideModal('confirmation-modal'));
            document.getElementById('apply-config').addEventListener('click', applyConfigurations);
            document.getElementById('add-custom-theme-btn').addEventListener('click', addCustomTheme);
            document.getElementById('save-performance-entry').addEventListener('click', savePerformanceEntry);
            document.querySelectorAll('.difficulty-btn').forEach(btn => {
                btn.addEventListener('click', function () {
                    const difficulty = this.dataset.difficulty;
                    if (appState.currentDifficultyTopic) {
                        appState.topicDifficulties[appState.currentDifficultyTopic] = difficulty;
                        checkAllAchievements({ type: 'difficulty', topic: appState.currentDifficultyTopic });
                        updateAllStatsAndCharts();
                    }
                    hideModal('difficulty-modal');
                });
            });
        }
        
        // NOVO: Cronômetro de estudo persistente
        function startPersistentStudyTimer() {
            const display = document.getElementById('study-time-display');
            
            function formatTime(totalSeconds) {
                const hours = Math.floor(totalSeconds / 3600);
                const minutes = Math.floor((totalSeconds % 3600) / 60);
                // A linha abaixo que calcula os segundos foi removida.
                // const seconds = totalSeconds % 60; 
                return `Tempo de estudo⏱️ ${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}`;
            }

            // Atualiza a UI imediatamente com o tempo carregado
            if(display) display.textContent = formatTime(appState.userProfile.totalStudyTimeSeconds);

            // Limpa qualquer timer antigo para evitar duplicação
            if(appState.studyTimerInterval) clearInterval(appState.studyTimerInterval);

            appState.studyTimerInterval = setInterval(() => {
                appState.userProfile.totalStudyTimeSeconds++;
                if(display) display.textContent = formatTime(appState.userProfile.totalStudyTimeSeconds);
                
                // Salva o progresso a cada 60 segundos
                if (appState.userProfile.totalStudyTimeSeconds % 60 === 0) {
                    saveAllData();
                }
            }, 1000);
        }

        // RESTANTE DAS FUNÇÕES (HELPER, UI, ETC.)
        // ---------------------------------------------------------------------------------
        function getAreaName(area) { const names = { preventiva: "PREV", pediatria: "PED", ginecologia: "GIN", obstetricia: "OBS", clinica: "CLM", cirurgia: "CIR", psiquiatria: "PSI", revisao: "REV", rest: "Off" }; return names[area] || "Geral"; }
        function getAreaIcon(area) { const icons = { preventiva: "fas fa-users", pediatria: "fas fa-baby", ginecologia: "fas fa-venus", obstetricia: "fas fa-baby-carriage", clinica: "fas fa-stethoscope", cirurgia: "fas fa-scalpel", psiquiatria: "fas fa-brain", revisao: "fas fa-star", rest: "fas fa-couch" }; return icons[area] || "fas fa-book-medical"; }
        function formatDate(date) { if (!(date instanceof Date) || isNaN(date)) return ""; const userTimezoneOffset = date.getTimezoneOffset() * 60000; return new Date(date.getTime() + userTimezoneOffset).toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit' }); }
        function addTopicEventListeners() {
            document.querySelectorAll('.topic-checkbox').forEach(checkbox => {
                checkbox.addEventListener('change', function () {
                    const topic = this.dataset.topic;
                    const isChecked = this.checked;
                    document.querySelectorAll(`input.topic-checkbox[data-topic="${topic}"]`).forEach(box => { box.checked = isChecked; box.closest('.topic-row').querySelector('.topic-text').classList.toggle('completed', isChecked); });
                    if (isChecked) {
                        appState.completedTopics[topic] = true;
                        appState.lastReviewDates[topic] = new Date().toISOString();
                        showModal('difficulty-modal');
                        appState.currentDifficultyTopic = topic;
                        addXp(XP_VALUES.completeTopic, 'topic-complete');
                        updateStudyStreak();
                    } else {
                        delete appState.completedTopics[topic];
                        delete appState.lastReviewDates[topic];
                        delete appState.topicDifficulties[topic];
                    }
                    checkAllAchievements({ type: 'completion', topic: topic });
                    updateAllStatsAndCharts();
                });
            });
        }
        function generateDynamicWeeks(schedule) {
            const weeksContainer = document.getElementById('weeks');
            weeksContainer.innerHTML = '';
            if (!schedule || schedule.length === 0) { weeksContainer.innerHTML = '<p style="text-align: center; padding: 20px;">Nenhum cronograma para exibir.</p>'; return; }
            const dayNames = ['Domingo', 'Segunda', 'Terça', 'Quarta', 'Quinta', 'Sexta', 'Sábado'];
            schedule.forEach(week => {
                const weekElement = document.createElement('div');
                weekElement.className = 'week-section fade-in';
                const maxThemesInWeek = Math.max(0, ...week.days.map(d => d.isRest ? 0 : (d.themes ? d.themes.length : 0)));
                let tableHeaderHTML = `<thead><tr><th>Dia</th>${maxThemesInWeek > 0 ? Array.from({length: maxThemesInWeek}, (_, i) => `<th>Tema ${i + 1}</th>`).join('') : `<th>Atividade</th>`}</tr></thead>`;
                let tableBodyHTML = '<tbody>';
                week.days.forEach(day => {
                    if (day.isRest) { tableBodyHTML += `<tr class="rest-day"><td colspan="${1 + Math.max(1, maxThemesInWeek)}">${day.themes[0].theme}</td></tr>`; }
                    else {
                        tableBodyHTML += `<tr><td><b>${dayNames[day.date.getUTCDay()]}</b><br>${formatDate(day.date)}</td>`;
                        if (maxThemesInWeek > 0) {
                            if (day.themes.length === 0) { tableBodyHTML += `<td colspan="${maxThemesInWeek}"><i>Dia livre</i></td>`; }
                            else { for (let i = 0; i < maxThemesInWeek; i++) {
                                const topic = day.themes ? day.themes[i] : null;
                                if (topic) {
                                    const topicId = (topic.theme + i).replace(/[^a-zA-Z0-9]/g, "");
                                    tableBodyHTML += `<td><div class="topic-row" data-topic-area="${topic.area}"><input type="checkbox" class="topic-checkbox" id="chk-${topicId}" ${appState.completedTopics[topic.theme] ? "checked" : ""} data-topic="${topic.theme}"><label for="chk-${topicId}" class="topic-text-label"><span class="topic-text ${appState.completedTopics[topic.theme] ? "completed" : ""}">${topic.theme}</span><div class="area-badge area-${topic.area}">${getAreaName(topic.area)}</div></label><button class="btn-ia" onclick="gerarFlashcardIA('${topic.theme}')">🤖 Flashcard IA</button></div></td>`;
                                } else { tableBodyHTML += '<td>-</td>'; }
                            }}
                        } else { tableBodyHTML += `<td><i>Dia livre</i></td>`; }
                        tableBodyHTML += '</tr>';
                    }
                });
                tableBodyHTML += '</tbody>';
                weekElement.innerHTML = `<div class="week-header"><span>${week.title}</span><i class="fas fa-chevron-down"></i></div><div class="week-content"><table class="week-table">${tableHeaderHTML}${tableBodyHTML}</table></div>`;
                weeksContainer.appendChild(weekElement);
                weekElement.querySelector('.week-header').addEventListener('click', function () { this.nextElementSibling.classList.toggle('collapsed'); this.querySelector('i').className = this.nextElementSibling.classList.contains('collapsed') ? 'fas fa-chevron-right' : 'fas fa-chevron-down'; });
            });
            addTopicEventListeners();
            updateStatusIcons();
        }
        async function gerarFlashcardIA(tema, tentativa = 1) {
  const modal = document.getElementById('ia-flashcard-modal');
  const titleElement = document.getElementById('ia-flashcard-title');
  const contentElement = document.getElementById('ia-resumo');
  
  titleElement.textContent = tema;
  contentElement.innerHTML = `<div style="text-align:center;"><span class="loading-hourglass">⏳</span> ⚠️ Esse Resumo é Criado por IA 🤖 </div>`;
  
  showModal('ia-flashcard-modal');

  try {
    const controller = new AbortController();
    const timeoutId = setTimeout(() => controller.abort(), 10000); // 10s timeout

    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${GEMINI_API_KEY}`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
  "contents": [{
    "parts": [{
      "text": `Crie um resumo estratégico de ${tema} para leitura pré-estudo no Revalida 2025. 

## ESTRUTURA OBRIGATÓRIA (máximo 6 linhas):

**DEFINIÇÃO:** O que é em 1 frase objetiva

**EPIDEMIOLOGIA/CAUSA:** Principais fatores (idade, sexo, causas mais comuns)

**QUADRO CLÍNICO:** 3-4 sintomas/sinais mais importantes

**DIAGNÓSTICO:** Exame padrão-ouro ou critérios diagnósticos

**TRATAMENTO:** Primeira linha de tratamento/conduta inicial

**ALERTA PROVA:** O que a banca MAIS cobra sobre este tema

## DIRETRIZES:
- Use terminologia médica precisa
- Cite valores de referência quando relevante
- Foque em CONDUTAS práticas, não fisiopatologia
- Mencione protocolos brasileiros (MS/SBP/FEBRASGO quando aplicável)
- Priorize informações de ALTA FREQUÊNCIA na prova
- Seja CONCISO - cada palavra deve agregar valor

## CONTEXTO:
Este resumo será lido em 30-60 segundos antes do estudo aprofundado do tema. O objetivo é ativar conhecimentos prévios e criar um "mapa mental" para o estudo posterior.

Termine sempre com: "**FOCO REVALIDA:** [aspecto mais cobrado na prova]"`
    }]
  }],
  "generationConfig": {
    "maxOutputTokens": 300,
    "temperature": 0.5
  }
}),
      signal: controller.signal
    });
    clearTimeout(timeoutId);

    if (!response.ok) {
      if (response.status === 503 && tentativa < 3) {
        await new Promise(resolve => setTimeout(resolve, 2000)); // Espera 2s antes de retry
        return gerarFlashcardIA(tema, tentativa + 1); // Tenta novamente
      }
      throw new Error(`Erro na API: ${response.status}`);
    }

    const data = await response.json();
    const resposta = data?.candidates?.[0]?.content?.parts?.[0]?.text || "Sem resposta.";
    contentElement.innerHTML = `<div style="white-space: pre-wrap;">${resposta}</div>`;

  } catch (err) {
    contentElement.innerHTML = `
      <div style="color: var(--error-color);">
        ${err.message.includes("503") ? "⚠️ Servidor sobrecarregado. Tente novamente mais tarde." : "Erro: " + err.message}
      </div>
    `;
  }
}
        function startPomodoro() { if (!appState.pomodoroRunning) { appState.pomodoroRunning = true; appState.pomodoroInterval = setInterval(updatePomodoro, 1000); document.getElementById('pomodoro-start').disabled = true; document.getElementById('pomodoro-pause').disabled = false; } }
        function pausePomodoro() { if (appState.pomodoroRunning) { clearInterval(appState.pomodoroInterval); appState.pomodoroRunning = false; document.getElementById('pomodoro-start').disabled = false; document.getElementById('pomodoro-pause').disabled = true; } }
        function resetPomodoro() { const isFocus = appState.currentPomodoroType === 'focus'; pausePomodoro(); const time = parseInt(document.getElementById(isFocus ? 'focus-time' : 'break-time').value) || (isFocus ? 25 : 5); appState.pomodoroTime = time * 60; updatePomodoroDisplay(); document.getElementById('pomodoro-start').disabled = false; document.getElementById('pomodoro-pause').disabled = true; }
        function updatePomodoro() { appState.pomodoroTime--; updatePomodoroDisplay(); if (appState.pomodoroTime < 0) { if (appState.currentPomodoroType === 'focus') { appState.userProfile.completedPomodoros++; addXp(XP_VALUES.pomodoroComplete, 'pomodoro'); appState.currentPomodoroType = 'break'; alert('Foco finalizado! Hora da pausa.'); } else { appState.currentPomodoroType = 'focus'; alert('Pausa finalizada! Hora de focar.'); } checkAllAchievements(); resetPomodoro(); } }
        function updatePomodoroDisplay() { const minutes = Math.floor(appState.pomodoroTime / 60); const seconds = appState.pomodoroTime % 60; document.getElementById('pomodoro-display').textContent = `${minutes.toString().padStart(2, "0")}:${seconds.toString().padStart(2, "0")}`; }
        function updateStats() { prepareAllTopics(); const totalTopics = appState.allTopicsFlat.filter(t => t.area !== 'rest' && t.area !== 'revisao').length; const completedCount = Object.keys(appState.completedTopics).length; const percentage = totalTopics > 0 ? Math.round((completedCount / totalTopics) * 100) : 0; document.getElementById('completed-count').textContent = completedCount; document.getElementById('progress-fill').style.width = `${percentage}%`; document.getElementById('progress-percentage').textContent = `${percentage}% de ${totalTopics} temas`; updateCountdown(); updateAverageDifficulty(); }
        function updateCountdown() { const examDate = new Date(`${appState.scheduleConfig.examDate}T12:00:00Z`); const diffDays = Math.ceil((examDate - new Date()) / (1000 * 60 * 60 * 24)); document.getElementById('days-left').textContent = diffDays > 0 ? diffDays : 0; }
        function updateAverageDifficulty() { const difficulties = Object.values(appState.topicDifficulties); if (difficulties.length === 0) { document.getElementById('avg-difficulty').textContent = '-'; return; } const difficultyMap = { easy: 1, medium: 2, hard: 3 }; const avg = difficulties.reduce((sum, diff) => sum + difficultyMap[diff], 0) / difficulties.length; document.getElementById('avg-difficulty').textContent = avg < 1.5 ? 'Fácil' : avg < 2.5 ? 'Médio' : 'Difícil'; }
        function updateStatusIcons() { document.querySelectorAll('.topic-checkbox').forEach(checkbox => { const topic = checkbox.dataset.topic; const isCompleted = appState.completedTopics[topic]; checkbox.checked = isCompleted; checkbox.closest('.topic-row').querySelector('.topic-text').classList.toggle('completed', isCompleted); }); }
        function createCompletionChart() { const ctx = document.getElementById('graficoPorMateria').getContext('2d'); if (!ctx || !document.getElementById('stats-section').classList.contains('active')) return; if (appState.charts.completionBySubject) appState.charts.completionBySubject.destroy(); const data = {}; const areas = ['preventiva', 'pediatria', 'ginecologia', 'obstetricia', 'clinica', 'cirurgia', 'psiquiatria', 'revisao']; areas.forEach(area => data[area] = { total: 0, feitos: 0, cor: getComputedStyle(document.documentElement).getPropertyValue(`--area-${area}`).trim() || '#607D8B', nome: getAreaName(area) }); appState.allTopicsFlat.forEach(topic => { if (data[topic.area]) { data[topic.area].total++; if (appState.completedTopics[topic.theme]) data[topic.area].feitos++; } }); const labels = [], porcentagens = [], cores = []; for (let key in data) { if (data[key].total > 0) { labels.push(data[key].nome); porcentagens.push(Math.round((data[key].feitos / data[key].total) * 100)); cores.push(data[key].cor); } } const isDarkMode = appState.darkMode; const gridColor = isDarkMode ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.05)'; const tickColor = isDarkMode ? '#f5f5f5' : '#666'; appState.charts.completionBySubject = new Chart(ctx, { type: 'bar', data: { labels, datasets: [{ label: '% Concluído', data: porcentagens, backgroundColor: cores, borderRadius: 5 }] }, options: { responsive: true, maintainAspectRatio: false, indexAxis: 'y', plugins: { legend: { display: false } }, scales: { y: { ticks: { color: tickColor }, grid: { display: false } }, x: { beginAtZero: true, max: 100, ticks: { color: tickColor, callback: val => `${val}%` }, grid: { color: gridColor } } } } }); }
        function createPerformanceByAreaChart() { const ctx = document.getElementById('graficoDesempenhoPorArea').getContext('2d'); if (!ctx || !document.getElementById('stats-section').classList.contains('active')) return; if (appState.charts.performanceByArea) appState.charts.performanceByArea.destroy(); const perfData = {}; const areas = ['preventiva', 'pediatria', 'ginecologia', 'obstetricia', 'clinica', 'cirurgia', 'psiquiatria', 'revisao']; areas.forEach(area => perfData[area] = { attempted: 0, correct: 0, cor: getComputedStyle(document.documentElement).getPropertyValue(`--area-${area}`).trim() || '#607D8B', nome: getAreaName(area) }); appState.performanceLog.forEach(entry => { const topicDetails = appState.allTopicsFlat.find(t => t.theme === entry.topic); if (topicDetails && perfData[topicDetails.area]) { perfData[topicDetails.area].attempted += entry.attempted; perfData[topicDetails.area].correct += entry.correct; } }); const labels = [], porcentagens = [], cores = []; for (let key in perfData) { if (perfData[key].attempted > 0) { labels.push(perfData[key].nome); porcentagens.push(Math.round((perfData[key].correct / perfData[key].attempted) * 100)); cores.push(perfData[key].cor); } } if (labels.length === 0) { ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height); ctx.font = "16px Roboto"; ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--text-color'); ctx.textAlign = "center"; ctx.fillText("Nenhum dado de desempenho para exibir.", ctx.canvas.width / 2, 50); return; } const isDarkMode = appState.darkMode; const gridColor = isDarkMode ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.05)'; const tickColor = isDarkMode ? '#f5f5f5' : '#666'; appState.charts.performanceByArea = new Chart(ctx, { type: 'bar', data: { labels, datasets: [{ label: '% de Acerto', data: porcentagens, backgroundColor: cores, borderRadius: 5 }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true, max: 100, ticks: { color: tickColor, callback: val => `${val}%` }, grid: { color: gridColor } }, x: { ticks: { color: tickColor }, grid: { display: false } } } } }); }
        function updateProgressLists() { const container = document.getElementById('progress-lists'); if (!container) return; const areas = {}; prepareAllTopics(); for (const topicName in appState.completedTopics) { const topicDetails = appState.allTopicsFlat.find(t => t.theme === topicName); if (topicDetails) { const area = topicDetails.area; if (!areas[area]) areas[area] = { name: getAreaName(area), icon: getAreaIcon(area), topics: [] }; const daysPassed = Math.floor((new Date() - new Date(appState.lastReviewDates[topicName])) / 864e5); areas[area].topics.push({ name: topicName, daysPassed }); } } let html = ''; for (const areaId in areas) { const area = areas[areaId]; if (area.topics.length === 0) continue; area.topics.sort((a, b) => a.daysPassed - b.daysPassed); const topicsHtml = area.topics.map(topic => `<li class="topic-item"><span>${topic.name}</span> <span class="days-badge ${topic.daysPassed > 14 ? 'danger' : topic.daysPassed > 7 ? 'warning' : ''}">${topic.daysPassed} dias</span></li>`).join(''); html += `<div class="progress-list"><h4><i class="${area.icon}"></i> ${area.name}</h4><ul>${topicsHtml}</ul></div>`; } container.innerHTML = html || '<p style="text-align: center; padding: 20px;">Nenhum tema concluído ainda.</p>'; }
        function updateFutureReviews() { const container = document.getElementById('future-reviews-container'); if (!container) return; const now = new Date(); const urgent = [], soon = [], scheduled = []; let pendingCount = 0; if (Object.keys(appState.completedTopics).length === 0) { container.innerHTML = '<p style="text-align: center; padding: 20px;">Nenhum tema para revisar.</p>'; document.getElementById('reviews-pending').textContent = '0'; return; } for (const topic in appState.completedTopics) { if (!appState.lastReviewDates[topic]) continue; const lastReview = new Date(appState.lastReviewDates[topic]); const difficulty = appState.topicDifficulties[topic] || 'medium'; const interval = { easy: 15, medium: 7, hard: 3 }[difficulty] || 7; const daysUntil = interval - Math.floor((now - lastReview) / 864e5); const item = { topic, difficulty, daysUntil, lastReview: formatDate(lastReview) }; if (daysUntil <= 0) { item.status = `Atrasada ${Math.abs(daysUntil)}d`; item.statusClass = 'urgent'; urgent.push(item); pendingCount++; } else if (daysUntil <= 3) { item.status = `Em ${daysUntil}d`; item.statusClass = 'soon'; soon.push(item); } else { item.status = `Em ${daysUntil}d`; scheduled.push(item); } } document.getElementById('reviews-pending').textContent = pendingCount; const renderGroup = (title, icon, reviews) => { if (reviews.length === 0) return ''; return `<div class="review-group"><h4><i class="${icon}"></i> ${title} (${reviews.length})</h4>${reviews.map(r => `<div class="review-item"><div class="review-info"><strong>${r.topic}</strong><div>Última revisão: ${r.lastReview}</div></div><div class="review-actions"><span class="review-due ${r.statusClass}">${r.status}</span><button class="btn" onclick="markAsReviewed('${r.topic.replace(/'/g, "\\'")}')"><i class="fas fa-check"></i> Revisado</button></div></div>`).join('')}</div>`; }; container.innerHTML = `${renderGroup('Atrasadas', 'fas fa-exclamation-triangle', urgent)}${renderGroup('Próximas', 'fas fa-hourglass-half', soon)}${renderGroup('Programadas', 'fas fa-calendar-check', scheduled)}` || '<p style="text-align: center;">Nenhuma revisão programada.</p>'; }
        function populatePerformanceTopicSelect() { const select = document.getElementById('perf-topic-select'); if (!select || select.options.length > 1) return; const areas = {}; appState.allTopicsFlat.forEach(topic => { if (topic.area === 'rest') return; if (!areas[topic.area]) areas[topic.area] = []; areas[topic.area].push(topic.theme); }); select.innerHTML = '<option value="">Selecione um tema...</option>'; for (const areaId in areas) { const optgroup = document.createElement('optgroup'); optgroup.label = getAreaName(areaId).toUpperCase(); areas[areaId].sort().forEach(themeName => { const option = document.createElement('option'); option.value = themeName; option.textContent = themeName; optgroup.appendChild(option); }); select.appendChild(optgroup); } }
        function savePerformanceEntry() { const date = document.getElementById('perf-date').value; const topic = document.getElementById('perf-topic-select').value; const attempted = parseInt(document.getElementById('perf-questions-attempted').value); const correct = parseInt(document.getElementById('perf-questions-correct').value); if (!date || !topic || isNaN(attempted) || isNaN(correct) || correct > attempted || attempted <= 0) { alert('Preencha todos os campos corretamente.'); return; } appState.performanceLog.push({ id: Date.now(), date, topic, attempted, correct }); renderPerformanceHistory(); addXp(XP_VALUES.performanceEntry, 'performance'); updateStudyStreak(); checkAllAchievements({ type: 'simulado' }); document.getElementById('perf-topic-select').value = ""; document.getElementById('perf-questions-attempted').value = ""; document.getElementById('perf-questions-correct').value = ""; alert('Registro salvo!'); }
        function renderPerformanceHistory() { const container = document.getElementById('performance-history-container'); if (!container) return; if (appState.performanceLog.length === 0) { container.innerHTML = '<p class="config-hint" style="text-align: center;">Nenhum registro.</p>'; return; } let tableHTML = `<table class="performance-table"><thead><tr><th>Data</th><th>Tema</th><th>Área</th><th>Questões</th><th>Acertos</th><th>%</th><th>Ações</th></tr></thead><tbody>`; [...appState.performanceLog].sort((a, b) => new Date(b.date) - new Date(a.date)).forEach(entry => { const topicDetails = appState.allTopicsFlat.find(t => t.theme === entry.topic); const area = topicDetails ? topicDetails.area : 'N/A'; const percentage = Math.round((entry.correct / entry.attempted) * 100); let percClass = percentage >= 80 ? 'good' : (percentage < 60 ? 'bad' : 'medium'); tableHTML += `<tr><td>${new Date(entry.date).toLocaleDateString('pt-BR')}</td><td>${entry.topic}</td><td>${getAreaName(area)}</td><td>${entry.attempted}</td><td>${entry.correct}</td><td class="percentage-col ${percClass}">${percentage}%</td><td><button class="btn btn-danger" onclick="deletePerformanceEntry(${entry.id})"><i class="fas fa-trash"></i></button></td></tr>`; }); tableHTML += '</tbody></table>'; container.innerHTML = tableHTML; }
        function deletePerformanceEntry(id) { if (!confirm('Tem certeza?')) return; appState.performanceLog = appState.performanceLog.filter(entry => entry.id !== id); renderPerformanceHistory(); if (appState.currentSection === 'stats') createPerformanceByAreaChart(); saveAllData(); }
        function applyConfigurations() { const startDate = document.getElementById('start-date').value; const examDate = document.getElementById('exam-date').value; const maxTopicsPerDay = parseInt(document.getElementById('max-topics-day').value); if (!startDate || !examDate || isNaN(maxTopicsPerDay) || new Date(startDate) >= new Date(examDate)) { alert('Verifique as configurações.'); return; } appState.scheduleConfig = { startDate, examDate, maxTopicsPerDay }; regenerateAndRenderSchedule(); alert('Cronograma atualizado!'); showSection('weeks'); saveAllData(); }
        function addCustomTheme() { const nameInput = document.getElementById('custom-theme-name'); const themeName = nameInput.value.trim(); const themeArea = document.getElementById('custom-theme-area').value; if (!themeName || [...originalScheduleData, ...appState.customThemes].some(t => t.theme.toLowerCase() === themeName.toLowerCase())) { alert('Nome inválido ou já existe.'); return; } appState.customThemes.push({ theme: themeName, area: themeArea }); nameInput.value = ""; renderCustomThemesList(); saveAllData(); }
        function removeCustomTheme(themeNameToRemove) { appState.customThemes = appState.customThemes.filter(theme => theme.theme !== themeNameToRemove); renderCustomThemesList(); saveAllData(); }
        function renderCustomThemesList() { const list = document.getElementById('custom-themes-list'); list.innerHTML = appState.customThemes.length === 0 ? '<p class="config-hint">Nenhum tema personalizado.</p>' : '<h5>Seus Temas:</h5>'; appState.customThemes.forEach(theme => { const item = document.createElement('div'); item.className = 'custom-theme-item'; item.innerHTML = `<span><span class="area-badge area-${theme.area}">${getAreaName(theme.area)}</span> ${theme.theme}</span> <button class="btn btn-danger" data-theme-name="${theme.theme}"><i class="fas fa-times"></i></button>`; list.appendChild(item); item.querySelector('button').addEventListener('click', () => removeCustomTheme(theme.theme)); }); }
        window.markAsReviewed = function (topic) { appState.lastReviewDates[topic] = new Date().toISOString(); if (appState.currentSection === 'review') updateFutureReviews(); addXp(5); updateStudyStreak(); checkAllAchievements({ type: 'review', topic }); };
        
    </script>
</body>
</html>
